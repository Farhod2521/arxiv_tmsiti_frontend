<!DOCTYPE html>
<html lang="en">

<head>
    <title>arxiv. Xodimlar paneli</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="DexignZone">
    <meta name="robots" content="">
    <meta name="keywords" content="admin dashboard, admin template, administration, analytics, bootstrap, broker, medical dashboard, modern, property, property admin, real estate, responsive admin dashboard">
    <meta name="description" content="arxiv - Hujjatlar boshqaruvi tizimi">
    <meta property="og:title" content="arxiv - Xodimlar Paneli">
    <meta property="og:description" content="arxiv - Hujjatlarni boshqarish va monitoring qilish tizimi">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link href="vendor/jquery-nice-select/css/nice-select.css" rel="stylesheet">
    <link rel="stylesheet" href="vendor/dotted-map/css/contrib/jquery.smallipop-0.3.0.min.css" type="text/css" media="all">
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Notification styles - React style */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 999999;
            max-width: 350px;
        }

        .notification {
            margin-bottom: 15px;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideIn 0.3s ease-out;
            transform: translateX(0);
            opacity: 1;
            transition: all 0.3s ease;
        }

        .notification.hide {
            transform: translateX(100%);
            opacity: 0;
        }

        .notification.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-left: 4px solid #1e7e34;
        }

        .notification.error {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border-left: 4px solid #bd2130;
        }

        .notification.warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #212529;
            border-left: 4px solid #d39e00;
        }

        .notification.info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            border-left: 4px solid #117a8b;
        }

        .notification-icon {
            margin-right: 12px;
            font-size: 20px;
        }

        .notification-content {
            flex-grow: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 3px;
            font-size: 16px;
        }

        .notification-message {
            font-size: 14px;
            opacity: 0.9;
        }

        .notification-close {
            background: none;
            border: none;
            color: inherit;
            font-size: 18px;
            cursor: pointer;
            opacity: 0.7;
            margin-left: 10px;
            transition: opacity 0.2s;
        }

        .notification-close:hover {
            opacity: 1;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Progress bar for auto-hide notifications */
        .notification-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 0 0 8px 8px;
            overflow: hidden;
        }

        .notification-progress-bar {
            height: 100%;
            background: rgba(255, 255, 255, 0.7);
            width: 100%;
            animation: progressBar 5s linear forwards;
        }

        @keyframes progressBar {
            from {
                width: 100%;
            }
            to {
                width: 0%;
            }
        }
        /* Drag & Drop uchun qo'shimcha stillar */
        .sortable-handle {
            cursor: move;
            color: #6c757d;
        }

        .sortable-handle:hover {
            color: #0d6efd;
        }

        .sortable-ghost {
            opacity: 0.5;
            background-color: #e9ecef;
        }

        .sortable-chosen {
            background-color: #f8f9fa;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .sortable-drag {
            background-color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .category-actions, .document-actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        .category-actions button, .document-actions button {
            padding: 5px 10px;
        }
        
        .documents-table {
            background-color: #f8f9fa;
        }
        
        .documents-table th {
            background-color: #e9ecef;
        }
        
        .add-category-btn {
            margin-bottom: 15px;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 20px;
        }
        
        .error-message {
            display: none;
        }
        
        .department-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            font-weight: bold;
        }
        
        .documents-section {
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .no-categories {
            text-align: center;
            color: #6c757d;
            font-style: italic;
        }
        
        .category-row {
            cursor: pointer;
        }
        
        .category-row:hover {
            background-color: #f8f9fa;
        }
        
        .logout-modal .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .logout-modal .modal-header {
            border-bottom: 1px solid #e9ecef;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px 15px 0 0;
        }
        
        .logout-modal .modal-footer {
            border-top: 1px solid #e9ecef;
            border-radius: 0 0 15px 15px;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .big-category-name {
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 5px;
            display: block;
        }
        .documents-row {
            background-color: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .documents-row.show {
            display: table-row !important;
        }
        
        .category-row + .documents-row {
            border-top: 2px solid #dee2e6;
        }
    </style>
</head>

<body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="lds-ripple">
            <div></div>
            <div></div>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->
<!-- Notification Container -->
<div id="notification-container" class="notification-container"></div>
    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
        <div class="nav-header">
            <a href="employe.html" class="brand-logo">
                <svg width="160" height="44" viewBox="0 0 160 44" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="0" y="0" width="44" height="44" rx="12" fill="#1A73E8"></rect>
                    <path d="M14 28V18C14 16.9 14.9 16 16 16H28C29.1 16 30 16.9 30 18V28C30 29.1 29.1 30 28 30H16C14.9 30 14 29.1 14 28Z" stroke="white" stroke-width="2" stroke-linejoin="round"></path>
                    <path d="M18 20H26" stroke="white" stroke-width="2" stroke-linecap="round"></path>
                    <path d="M18 24H26" stroke="white" stroke-width="2" stroke-linecap="round"></path>
                    <text x="60" y="29" font-family="Poppins, sans-serif" font-size="26" font-weight="700" fill="#273240" letter-spacing="0.5">
                        arxiv.
                    </text>
                </svg>
            </a>
            <div class="nav-control">
                <div class="hamburger">
                    <span class="line"></span><span class="line"></span><span class="line"></span>
                </div>
            </div>
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->
        
        <!--**********************************
            Header start
        ***********************************-->
        <div class="header">
            <div class="header-content">
                <nav class="navbar navbar-expand">
                    <div class="collapse navbar-collapse justify-content-between">
                        <div class="header-left">
                            <div class="nav-item">
                                <div class="input-group search-area">
                                    <input type="text" class="form-control" placeholder="Ma'lumot qidirish" id="searchInput">
                                    <span class="input-group-text"><a href="javascript:void(0)"><i class="flaticon-381-search-2"></i></a></span>
                                </div>
                            </div>
                        </div>
                        <ul class="navbar-nav header-right">
                            <li class="nav-item dropdown notification_dropdown">
                                <a class="nav-link bell dz-theme-mode" href="javascript:void(0);">
                                    <i id="icon-light" class="fas fa-sun"></i>
                                    <i id="icon-dark" class="fas fa-moon"></i>
                                </a>
                            </li>
                            <li class="nav-item dropdown notification_dropdown">
                                <a class="nav-link" href="javascript:void(0);" role="button" data-bs-toggle="dropdown">
                                   <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M10.4524 25.6682C11.0605 27.0357 12.409 28 14.0005 28C15.592 28 16.9405 27.0357 17.5487 25.6682C16.4265 25.7231 15.2594 25.76 14.0005 25.76C12.7417 25.76 11.5746 25.723 10.4524 25.6682Z" fill="#737B8B"/>
                                        <path d="M26.3532 19.74C24.877 17.8785 22.3996 14.2195 22.3996 10.64C22.3996 7.09073 20.1193 3.89758 16.7996 2.72382C16.7593 1.21406 15.5183 0 14.0007 0C12.482 0 11.2422 1.21406 11.2018 2.72382C7.88101 3.89758 5.6007 7.09073 5.6007 10.64C5.6007 14.2207 3.1244 17.8785 1.64712 19.74C1.15433 20.3616 1.00197 21.1825 1.24058 21.9363C1.47354 22.6721 2.05367 23.2422 2.79288 23.4595C4.08761 23.8415 6.20997 24.2715 9.44682 24.491C10.8479 24.5851 12.3543 24.64 14.0008 24.64C15.646 24.64 17.1525 24.5851 18.5535 24.491C21.7915 24.2715 23.9128 23.8415 25.2086 23.4595C25.9478 23.2422 26.5268 22.6722 26.7598 21.9363C26.9983 21.1825 26.8449 20.3616 26.3532 19.74Z" fill="#737B8B"/>
                                    </svg>
                                    <span class="badge light text-white bg-primary rounded-circle">4</span>
                                </a>
                                <div class="dropdown-menu dropdown-menu-end">
                                    <div id="DZ_W_Notification1" class="widget-media dz-scroll p-3" style="height:380px;">
                                        <ul class="timeline">
                                            <li>
                                                <div class="timeline-panel">
                                                    <div class="media me-2">
                                                        <img alt="image" width="50" src="images/avatar/1.jpg">
                                                    </div>
                                                    <div class="media-body">
                                                        <h6 class="mb-1">Yangi hujjat qo'shildi</h6>
                                                        <small class="d-block">29 July 2020 - 02:26 PM</small>
                                                    </div>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="timeline-panel">
                                                    <div class="media me-2 media-info">
                                                        KG
                                                    </div>
                                                    <div class="media-body">
                                                        <h6 class="mb-1">Hisobot yaratildi</h6>
                                                        <small class="d-block">29 July 2020 - 02:26 PM</small>
                                                    </div>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="timeline-panel">
                                                    <div class="media me-2 media-success">
                                                        <i class="fa fa-home"></i>
                                                    </div>
                                                    <div class="media-body">
                                                        <h6 class="mb-1">Yangi foydalanuvchi qo'shildi</h6>
                                                        <small class="d-block">29 July 2020 - 02:26 PM</small>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                    <a class="all-notification" href="javascript:void(0);">Barcha bildirishnomalar <i class="ti-arrow-end"></i></a>
                                </div>
                            </li>

                            <li class="nav-item dropdown header-profile">
                                <a class="nav-link" href="javascript:void(0);" role="button" data-bs-toggle="dropdown">
                                    <div class="header-info me-3">
                                        <span class="fs-18 font-w500 text-end" id="userName">Yuklanmoqda...</span>
                                        <small class="text-end fs-14 font-w400" id="userPhone">Yuklanmoqda...</small>
                                    </div>
                                    <img src="images/profile/pic1.jpg" width="20" alt="">
                                </a>
                                <div class="dropdown-menu dropdown-menu-end">
                                    <a href="app-profile.html" class="dropdown-item ai-icon">
                                        <svg id="icon-user1" xmlns="http://www.w3.org/2000/svg" class="text-primary" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                                        <span class="ms-2">Profil</span>
                                    </a>
                                    <a href="email-inbox.html" class="dropdown-item ai-icon">
                                        <svg id="icon-inbox" xmlns="http://www.w3.org/2000/svg" class="text-success" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                        <span class="ms-2">Xabarlar</span>
                                    </a>
                                    <a href="javascript:void(0);" class="dropdown-item ai-icon" onclick="logout()">
                                        <svg id="icon-logout" xmlns="http://www.w3.org/2000/svg" class="text-danger" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                                        <span class="ms-2">Chiqish</span>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <!--**********************************
            Header end ti-comment-alt
        ***********************************-->

        <!--**********************************
            Sidebar start
        ***********************************-->
       <div class="deznav">
            <div class="deznav-scroll">
                <ul class="metismenu" id="menu">
                    <li><a class="has-arrow " href="javascript:void()" aria-expanded="false">
                            <i class="flaticon-025-dashboard"></i>
                            <span class="nav-text">Boshqaruv paneli</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="employe.html">Bosh sahifa</a></li>
                            <li><a href="#">Hujjatlar</a></li>
                            <li><a href="#">Xodimlar</a></li>
                        </ul>
                    </li>
                    <li><a style="color: red;" href="javascript:void(0)" onclick="logout()" aria-expanded="false">
                            <i style="color: red;" class="flaticon-070-power"></i>
                            <span class="nav-text">Chiqish</span>
                        </a>
                    </li>
                </ul>
                <div class="plus-box">
                    <p class="fs-14 font-w600 mb-2">Hujjatlarni izlash va<br>boshqarish endi yanada oson</p>
                    <a class="btn btn-light btn-sm fs-14 text-black" href="javascript:void(0);">Batafsil</a>
                </div>
            </div>
        </div>
        <!--**********************************
            Sidebar end
        ***********************************-->
        
        <!--**********************************
            Content body start
        ***********************************-->
        <div class="content-body">
            <!-- row -->
            <div class="container-fluid">
                <div class="mb-sm-4 d-flex flex-wrap align-items-center text-head">
                    <h2 class="mb-3 me-auto">Monitoring paneli</h2>
                </div>    

                <div class="row">
                    <div class="col-xl-12 col-xxl-8">
                        <div class="row">
                            <div class="col-xl-12">
                                <div class="d-flex flex-wrap">
                                    <a href="javascript:void(0);" class="btn btn-primary add-category-btn" data-bs-toggle="modal" data-bs-target="#categoryModal">+ Kategoriya qo'shish</a>
                                    <div class="newest mb-4 me-3">
                                        <select class="form-control default-select ms-0 border" id="documentTypeFilter">
                                            <option>Hujjat turi</option>
                                            <option>PDF</option>
                                            <option>DOC</option>
                                            <option>XLS</option>
                                        </select>
                                    </div>    
                                    <div class="newest mb-3 me-3">
                                        <select class="form-control default-select ms-0 border" id="departmentFilter">
                                            <option>Bo'lim</option>
                                            <option>Barchasi</option>
                                        </select>
                                    </div>    
                                    <div class="newest mb-3 me-3">
                                        <select class="form-control default-select ms-0 border" id="dateFilter">
                                            <option>Sana</option>
                                            <option>Oxirgi 7 kun</option>
                                            <option>Oxirgi 30 kun</option>
                                            <option>Oxirgi 3 oy</option>
                                        </select>
                                    </div>    
                                    <div class="table-search mb-3 pe-3">    
                                        <div class="input-group search-area">
                                            <input type="text" class="form-control" placeholder="Ma'lumot qidirish" id="globalSearch">
                                            <span class="input-group-text"><a href="javascript:void(0)"><i class="flaticon-381-search-2"></i></a></span>
                                        </div>
                                    </div>   
                                    <a href="javascript:void(0);" class="btn btn-primary me-3 mb-3" onclick="applyFilters()">
                                        <i class="fas fa-calendar me-3"></i>Filtrlash
                                    </a>
                                    <a href="javascript:void(0);" class="btn btn-warning mb-3" onclick="refreshData()">
                                        <i class="fas fa-redo-alt"></i>
                                    </a>
                                </div>
                            </div>
                            
                            <div class="col-xl-12">
                                <!-- Yuklanish ko'rsatkichi -->
                                <div class="loading-spinner" id="loadingSpinner">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Yuklanmoqda...</span>
                                    </div>
                                    <p class="mt-2">Ma'lumotlar yuklanmoqda...</p>
                                </div>
                                
                                <!-- Xatolik xabari -->
                                <div class="error-message alert alert-danger" id="errorMessage">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <span id="errorText">Ma'lumotlarni yuklashda xatolik yuz berdi</span>
                                </div>
                                
                                <div class="table-responsive fs-14">
                                    <table class="table display mb-4 dataTablesCard order-table shadow-hover card-table" id="documentsTable">
                                        <thead>
                                            <tr>
                                                <th width="5%">â„–</th>
                                                <th width="15%">Indeks raqami</th>
                                                <th width="40%">Yig'ma jild sarlavhasi</th>
                                                <th width="20%">Izoh</th>
                                                <th width="20%">Amallar</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tableBody">
                                            <!-- Ma'lumotlar JavaScript orqali to'ldiriladi -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--**********************************
            Content body end
        ***********************************-->
    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!-- Logout Confirmation Modal -->
    <div class="modal fade logout-modal" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="logoutModalLabel">Tizimdan chiqish</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <i class="fas fa-sign-out-alt text-danger mb-3" style="font-size: 48px;"></i>
                        <h4 class="mb-3">Rostan ham tizimdan chiqmoqchimisiz?</h4>
                        <p class="text-muted">Agar chiqsangiz, qayta kirish uchun login qilishingiz kerak bo'ladi.</p>
                    </div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Bekor qilish
                    </button>
                    <button type="button" class="btn btn-danger" onclick="confirmLogout()">
                        <i class="fas fa-sign-out-alt me-2"></i>Ha, chiqish
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="categoryModalLabel">Kategoriya qo'shish</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="categoryForm">
                        <input type="hidden" id="categoryId">
                        <div class="mb-3">
                            <label for="bigCategory" class="form-label">Bo'lim</label>
                            <select class="form-control" id="bigCategory" required>
                                <option value="">Bo'limni tanlang</option>
                                <!-- JavaScript orqali to'ldiriladi -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="indeksRaqami" class="form-label">Indeks raqami</label>
                            <input type="text" class="form-control" id="indeksRaqami" required>
                        </div>
                        <div class="mb-3">
                            <label for="jildSarlavhasi" class="form-label">Yig'ma jild sarlavhasi</label>
                            <input type="text" class="form-control" id="jildSarlavhasi" required>
                        </div>
                        <div class="mb-3">
                            <label for="izoh" class="form-label">Izoh</label>
                            <textarea class="form-control" id="izoh" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bekor qilish</button>
                    <button type="button" class="btn btn-primary" id="saveCategoryBtn">Saqlash</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hujjat Modal -->
    <div class="modal fade" id="documentModal" tabindex="-1" aria-labelledby="documentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="documentModalLabel">Hujjat qo'shish</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="documentForm">
                        <input type="hidden" id="documentId">
                        <div class="mb-3">
                            <label for="hujjatNomi" class="form-label">Hujjat nomi</label>
                            <input type="text" class="form-control" id="hujjatNomi" required>
                        </div>
                        <div class="mb-3">
                            <label for="faylTuri" class="form-label">Fayl turi</label>
                            <select class="form-control" id="faylTuri" required>
                                <option value="">Tanlang</option>
                                <option value="PDF">PDF</option>
                                <option value="DOCX">Word (DOCX)</option>
                                <option value="XLSX">Excel (XLSX)</option>
                                <option value="PPTX">PowerPoint (PPTX)</option>
                                <option value="TXT">Matn fayli (TXT)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="faylYuklash" class="form-label">Fayl yuklash</label>
                            <input type="file" class="form-control" id="faylYuklash">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bekor qilish</button>
                    <button type="button" class="btn btn-primary" id="saveDocumentBtn">Saqlash</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">O'chirishni tasdiqlash</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <i class="fas fa-exclamation-triangle text-warning mb-3" style="font-size: 48px;"></i>
                        <h4 class="mb-3" id="deleteModalText">Ushbu elementni o'chirishni tasdiqlaysizmi?</h4>
                        <p class="text-muted">Bu amalni qaytarib bo'lmaydi.</p>
                    </div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Bekor qilish
                    </button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="fas fa-trash me-2"></i>Ha, o'chirish
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="vendor/global/global.min.js"></script>
    <script src="vendor/chart.js/Chart.bundle.min.js"></script>
    <script src="vendor/jquery-nice-select/js/jquery.nice-select.min.js"></script>
    <script src="vendor/apexchart/apexchart.js"></script>
    <script src="vendor/peity/jquery.peity.min.js"></script>
    <script src="vendor/dotted-map/js/contrib/jquery.smallipop-0.3.0.min.js"></script>
    <script src="vendor/dotted-map/js/contrib/suntimes.js"></script>
    <script src="vendor/dotted-map/js/contrib/color-0.4.1.js"></script>
    <script src="vendor/dotted-map/js/world.js"></script>
    <script src="vendor/dotted-map/js/smallimap.js"></script>
    <script src="js/dashboard/dotted-map-init.js"></script>
    <script src="js/custom.min.js"></script>
    <script src="js/deznav-init.js"></script>
    <script src="js/demo.js"></script>
    <script src="js/styleSwitcher.js"></script>
    
<script>
    // API URLs
    const API_BASE_URL = 'http://127.0.0.1:8000/api/v1';
    const DOCS_LIST_URL = `${API_BASE_URL}/docs/list/`;
    const DOCS_CRUD_URL = `${API_BASE_URL}/docs/`;
    const CATEGORY_CREATE_URL = `${API_BASE_URL}/category/create/`;
    const CATEGORY_UPDATE_URL = `${API_BASE_URL}/category/update/`;
    const CATEGORY_DELETE_URL = `${API_BASE_URL}/category/delete/`;
    const CATEGORY_REORDER_URL = `${API_BASE_URL}/category/reorder/`; // Drag & Drop uchun
    const BIG_CATEGORY_LIST_URL = `${API_BASE_URL}/docs/list/`;

    // Global variables
    let currentEditingCategoryId = null;
    let currentEditingDocumentId = null;
    let currentCategoryForDocument = null;
    let deleteType = ''; // 'category' or 'document'
    let deleteId = null;
    let bigCategories = [];

    // Authentication va ma'lumotlarni yuklash
    document.addEventListener('DOMContentLoaded', function() {
        const token = localStorage.getItem('authToken');
        
        if (!token) {
            window.location.href = 'login.html';
            return;
        }
        
        loadUserProfile();
        loadBigCategories();
        populateTable();
        setupSearch();
        setupEventListeners();
    });

    // Event listenerlarni sozlash
    function setupEventListeners() {
        // Category saqlash
        document.getElementById('saveCategoryBtn').addEventListener('click', saveCategory);
        
        // Hujjat saqlash
        document.getElementById('saveDocumentBtn').addEventListener('click', saveDocument);
        
        // O'chirishni tasdiqlash
        document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
        
        // Category qo'shish tugmasi
        document.querySelector('.add-category-btn').addEventListener('click', function() {
            currentEditingCategoryId = null;
            document.getElementById('categoryModalLabel').textContent = 'Kategoriya qo\'shish';
            document.getElementById('categoryId').value = '';
            document.getElementById('indeksRaqami').value = '';
            document.getElementById('jildSarlavhasi').value = '';
            document.getElementById('izoh').value = '';
            populateBigCategorySelect();
        });
    }
    // Notification system functions
    function showNotification(message, type = 'success', title = null, autoHide = true, duration = 5000) {
        const container = document.getElementById('notification-container');
        if (!container) {
            // Agar container bo'lmasa, yaratamiz
            createNotificationContainer();
        }
        
        const notificationId = 'notification-' + Date.now();
        const icons = {
            success: 'fa-check-circle',
            error: 'fa-exclamation-circle',
            warning: 'fa-exclamation-triangle',
            info: 'fa-info-circle'
        };
        
        const titles = {
            success: title || 'Muvaffaqiyatli',
            error: title || 'Xatolik',
            warning: title || 'Ogohlantirish',
            info: title || 'Ma\'lumot'
        };
        
        const notification = document.createElement('div');
        notification.id = notificationId;
        notification.className = `notification ${type}`;
        
        notification.innerHTML = `
            <div class="d-flex align-items-center w-100">
                <i class="notification-icon fas ${icons[type] || icons.success}"></i>
                <div class="notification-content">
                    <div class="notification-title">${titles[type]}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="removeNotification('${notificationId}')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            ${autoHide ? `<div class="notification-progress"><div class="notification-progress-bar"></div></div>` : ''}
        `;
        
        container.appendChild(notification);
        
        // Auto-hide qilish
        if (autoHide) {
            setTimeout(() => {
                removeNotification(notificationId);
            }, duration);
        }
        
        return notificationId;
    }

    function removeNotification(notificationId) {
        const notification = document.getElementById(notificationId);
        if (notification) {
            notification.classList.add('hide');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }
    }

    function createNotificationContainer() {
        const container = document.createElement('div');
        container.id = 'notification-container';
        container.className = 'notification-container';
        document.body.appendChild(container);
    }

    // Hujjat qo'shganda maxsus bildirishnoma
    function showDocumentAddedNotification(documentName) {
        showNotification(
            `"${documentName}" hujjati muvaffaqiyatli qo'shildi`,
            'success',
            'Hujjat qo\'shildi'
        );
    }

    // Category qo'shganda bildirishnoma
    function showCategoryAddedNotification(categoryName) {
        showNotification(
            `"${categoryName}" kategoriyasi muvaffaqiyatli qo'shildi`,
            'success',
            'Kategoriya qo\'shildi'
        );
    }

    // Document saqlash funksiyasini yangilaymiz (notification bilan)
    async function saveDocument() {
        const hujjatNomi = document.getElementById('hujjatNomi').value;
        const faylTuri = document.getElementById('faylTuri').value;
        const faylYuklash = document.getElementById('faylYuklash').files[0];
        const documentId = document.getElementById('documentId').value;
        
        if (!hujjatNomi || !faylTuri) {
            showNotification('Hujjat nomi va fayl turi maydonlari to\'ldirilishi shart', 'error');
            return;
        }
        
        if (!currentEditingDocumentId && !faylYuklash) {
            showNotification('Yangi hujjat uchun fayl yuklashingiz kerak', 'error');
            return;
        }
        
        const saveButton = document.getElementById('saveDocumentBtn');
        const originalText = saveButton.innerHTML;
        saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saqlanmoqda...';
        saveButton.disabled = true;
        
        const AUTH_TOKEN = localStorage.getItem('authToken');
        const url = currentEditingDocumentId ? 
            `${DOCS_CRUD_URL}${currentEditingDocumentId}/` : 
            DOCS_CRUD_URL;
        
        const method = currentEditingDocumentId ? 'PUT' : 'POST';
        
        const formData = new FormData();
        formData.append('title', hujjatNomi);
        formData.append('file_type', faylTuri);
        if (faylYuklash) {
            formData.append('file', faylYuklash);
        }
        if (currentCategoryForDocument) {
            formData.append('category', currentCategoryForDocument);
        }
        
        try {
            const response = await fetch(url, {
                method: method,
                headers: {
                    'Authorization': `Token ${AUTH_TOKEN}`,
                },
                body: formData
            });

            if (!response.ok) {
                let errorMessage = 'Saqlashda xatolik';
                try {
                    const errorData = await response.json();
                    errorMessage = errorData.error || errorData.detail || errorMessage;
                } catch (e) {
                    errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                }
                throw new Error(errorMessage);
            }

            const result = await response.json();
            
            // React usulidagi yashil bildirishnoma
            if (currentEditingDocumentId) {
                showNotification(`"${hujjatNomi}" hujjati muvaffaqiyatli yangilandi`, 'success', 'Hujjat yangilandi');
            } else {
                showDocumentAddedNotification(hujjatNomi);
            }
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('documentModal'));
            modal.hide();
            
            // Formani tozalash
            document.getElementById('documentForm').reset();
            
            // Jadvalni yangilash
            await populateTable();
            
        } catch (error) {
            console.error('Saqlashda xatolik:', error);
            showNotification('Saqlashda xatolik yuz berdi: ' + error.message, 'error');
        } finally {
            saveButton.innerHTML = originalText;
            saveButton.disabled = false;
        }
    }

    // Category modalini yopganda formani tozalash
    document.getElementById('categoryModal').addEventListener('hidden.bs.modal', function () {
        document.getElementById('categoryForm').reset();
        document.getElementById('categoryId').value = '';
        currentEditingCategoryId = null;
    });

    // Document modalini yopganda formani tozalash
    document.getElementById('documentModal').addEventListener('hidden.bs.modal', function () {
        document.getElementById('documentForm').reset();
        document.getElementById('documentId').value = '';
        currentEditingDocumentId = null;
        currentCategoryForDocument = null;
    });

    // Katta kategoriyalarni yuklash (bo'limlar ro'yxati)
    async function loadBigCategories() {
        const token = localStorage.getItem('authToken');
        
        try {
            const response = await fetch(BIG_CATEGORY_LIST_URL, {
                method: 'GET',
                headers: {
                    'Authorization': `Token ${token}`,
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) throw new Error('Bo\'limlar ro\'yxatini yuklashda xatolik');
            
            const data = await response.json();
            bigCategories = data;
            
        } catch (error) {
            console.error('Bo\'limlarni yuklashda xatolik:', error);
            // Agar API mavjud bo'lmasa, demo ma'lumotlar
            bigCategories = [
                { id: 1, title: "Ijro nazorati bo'limi" },
                { id: 2, title: "Boshqarma" },
                { id: 3, title: "Sektor" }
            ];
        }
    }

    // Katta kategoriyalarni select elementiga to'ldirish
    function populateBigCategorySelect() {
        const selectElement = document.getElementById('bigCategory');
        selectElement.innerHTML = '<option value="">Bo\'limni tanlang</option>';
        
        bigCategories.forEach(category => {
            const option = document.createElement('option');
            option.value = category.id;
            option.textContent = category.title;
            selectElement.appendChild(option);
        });
    }

    // Foydalanuvchi ma'lumotlarini yuklash
    async function loadUserProfile() {
        const token = localStorage.getItem('authToken');
        
        try {
            const response = await fetch(`${API_BASE_URL}/my-profile/`, {
                method: 'GET',
                headers: {
                    'Authorization': `Token ${token}`,
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) throw new Error('Profile yuklashda xatolik');
            
            const userData = await response.json();
            updateUserInfo(userData);
            
        } catch (error) {
            console.error('Foydalanuvchi ma\'lumotlarini yuklashda xatolik:', error);
            const storedUserData = localStorage.getItem('userData');
            if (storedUserData) {
                updateUserInfo(JSON.parse(storedUserData));
            }
        }
    }

    // Foydalanuvchi ma'lumotlarini yangilash
    function updateUserInfo(userData) {
        const userNameElement = document.getElementById('userName');
        const userPhoneElement = document.getElementById('userPhone');
        
        if (userNameElement && userData.full_name) {
            userNameElement.textContent = userData.full_name;
        }
        
        if (userPhoneElement && userData.phone) {
            userPhoneElement.textContent = userData.phone;
        }
        
        localStorage.setItem('userData', JSON.stringify(userData));
    }

    // Jadvalni to'ldirish funksiyasi
    // populateTable funksiyasini yangilaymiz
    async function populateTable() {
        showLoading();
        hideError();

        const AUTH_TOKEN = localStorage.getItem('authToken');
        
        if (!AUTH_TOKEN) {
            showError('Siz tizimga kirmagansiz. Iltimos, qaytadan kiring.');
            hideLoading();
            window.location.href = 'login.html';
            return;
        }

        try {
            const response = await fetch(DOCS_LIST_URL, {
                method: 'GET',
                headers: {
                    'Authorization': `Token ${AUTH_TOKEN}`,
                    'Content-Type': 'application/json',
                }
            });

            if (!response.ok) {
                if (response.status === 401) {
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('userData');
                    window.location.href = 'login.html';
                    return;
                }
                
                let errorData;
                try {
                    errorData = await response.json();
                } catch (e) {
                    errorData = { error: `HTTP ${response.status}: ${response.statusText}` };
                }
                
                throw new Error(errorData.error || errorData.detail || `HTTP xatolik! Status: ${response.status}`);
            }

            const data = await response.json();
            renderTable(data);
            hideLoading();

            // Drag & Drop ni sozlash
            setTimeout(() => {
                setupDragAndDrop();
            }, 100);

        } catch (error) {
            console.error('Ma\'lumotlarni yuklashda xatolik:', error);
            showError('Ma\'lumotlarni yuklashda xatolik yuz berdi: ' + error.message);
            
            // Xatolikda ham jadvalni bo'sh holatda ko'rsatish
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = `
                <tr>
                    <td colspan="5" class="text-center text-muted py-5">
                        <i class="fas fa-exclamation-triangle me-2"></i>Ma'lumotlarni yuklashda xatolik
                        <br><br>
                        <button class="btn btn-primary btn-sm" onclick="populateTable()">
                            <i class="fas fa-redo me-1"></i>Qayta urinish
                        </button>
                    </td>
                </tr>
            `;
            hideLoading();
        }
    }
    // Jadvalni chizish funksiyasi
    function renderTable(data) {
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = '';
        let rowCount = 1;

        if (!data || data.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="5" class="text-center text-muted">
                        <i class="fas fa-info-circle me-2"></i>Ma'lumotlar topilmadi
                    </td>
                </tr>
            `;
            return;
        }

        data.forEach(department => {
            // Bo'lim sarlavhasi qatori
            const deptRow = document.createElement('tr');
            deptRow.className = 'department-header';
            deptRow.innerHTML = `
                <td colspan="5" style="text-align: center; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; font-weight: bold; font-size: 20px; padding: 20px; border-radius: 2px; margin: 10px 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); border: 2px solid #1e3c72;">
                    <i class="fas fa-building me-2" style="font-size: 24px; color: #ffd700;"></i>${department.title}
                </td>
            `;
            tableBody.appendChild(deptRow);

            // Bo'limning kategoriyalari
            if (department.categories && department.categories.length > 0) {
                department.categories.forEach(category => {
                    const categoryRow = document.createElement('tr');
                    categoryRow.className = 'category-row';
                    categoryRow.setAttribute('data-category-id', category.id);
                    
                    categoryRow.innerHTML = `
                        <td>
                            <div class="d-flex align-items-center">
                                <i class="fas fa-arrows-alt sortable-handle me-2" style="cursor: move;"></i>
                                ${rowCount++}
                            </div>
                        </td>
                        <td class="wspace-no">${category.ichki_raqam || 'N/A'}</td>
                        <td>
                            <span class="big-category-name">${department.title}</span>
                            ${category.tartib_raqami || 'N/A'}
                        </td>
                        <td class="text-ov">${formatIzoh(category.izoh)}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary expand-btn" title="Hujjatlarni ko'rish" data-category-id="${category.id}">
                                    <i class="fas fa-chevron-down expand-icon"></i>
                                </button>
                                <button class="btn btn-sm btn-warning edit-category-btn" title="Tahrirlash" data-category-id="${category.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-category-btn" title="O'chirish" data-category-id="${category.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(categoryRow);

                    // Hujjatlar qatori
                    createDocumentsRow(category);
                });
            } else {
                const noCategoryRow = document.createElement('tr');
                noCategoryRow.innerHTML = `
                    <td colspan="5" class="no-categories">
                        <i class="fas fa-info-circle me-2"></i>Kategoriyalar mavjud emas
                    </td>
                `;
                tableBody.appendChild(noCategoryRow);
            }
        });
        
        addTableEventListeners();
    }

    // Drag & Drop ni sozlash funksiyasi
    function setupDragAndDrop() {
        // SortableJS kutubxonasini yuklash
        if (typeof Sortable === 'undefined') {
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js';
            script.onload = function() {
                initializeSortable();
            };
            document.head.appendChild(script);
        } else {
            initializeSortable();
        }
    }

    function initializeSortable() {
        const tableBody = document.getElementById('tableBody');
        
        if (!tableBody || typeof Sortable === 'undefined') {
            console.error('Sortable kutubxonasi yuklanmadi yoki tableBody topilmadi');
            return;
        }

        // Faqat kategoriya qatorlari uchun sortable qilish
        Sortable.create(tableBody, {
            animation: 150,
            handle: '.sortable-handle',
            ghostClass: 'sortable-ghost',
            chosenClass: 'sortable-chosen',
            dragClass: 'sortable-drag',
            filter: '.department-header, .documents-row', // Bo'lim sarlavlari va hujjat qatorlarini filter qilish
            preventOnFilter: false,
            draggable: '.category-row', // Faqat kategoriya qatorlari uchun
            onEnd: async function(evt) {
                // Drag tugagach, yangi tartibni saqlash
                await saveCategoryOrder();
            }
        });
    }

    // Kategoriyalar tartibini saqlash
    // Kategoriyalar tartibini saqlash (notification bilan)
    async function saveCategoryOrder() {
        const AUTH_TOKEN = localStorage.getItem('authToken');
        const categories = [];
        
        const categoryRows = document.querySelectorAll('.category-row');
        
        categoryRows.forEach((row, index) => {
            const categoryId = row.getAttribute('data-category-id');
            if (categoryId) {
                categories.push({
                    id: parseInt(categoryId),
                    order: index
                });
            }
        });
        
        if (categories.length === 0) {
            return;
        }
        
        try {
            const response = await fetch(CATEGORY_REORDER_URL, {
                method: 'POST',
                headers: {
                    'Authorization': `Token ${AUTH_TOKEN}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(categories)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Tartibni saqlashda xatolik');
            }

            const result = await response.json();
            
            // Tartib o'zgartirilganda bildirishnoma
            showNotification('Kategoriyalar tartibi muvaffaqiyatli yangilandi', 'success');
            
            updateOrderNumbers();
            
        } catch (error) {
            console.error('Tartibni saqlashda xatolik:', error);
            showNotification('Tartibni saqlashda xatolik yuz berdi: ' + error.message, 'error');
        }
    }

    // Tartib raqamlarini yangilash
    function updateOrderNumbers() {
        const categoryRows = document.querySelectorAll('.category-row');
        let orderNumber = 1;
        
        categoryRows.forEach(row => {
            const orderCell = row.querySelector('td:first-child');
            if (orderCell) {
                const handleIcon = orderCell.querySelector('.sortable-handle');
                orderCell.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas fa-arrows-alt sortable-handle me-2" style="cursor: move;"></i>
                        ${orderNumber++}
                    </div>
                `;
            }
        });
    }

    // Hujjatlar qatorini yaratish
    function createDocumentsRow(category) {
        const docsRow = document.createElement('tr');
        docsRow.className = 'documents-row collapse';
        docsRow.id = `docs-${category.id}`;
        docsRow.style.display = 'none'; // Boshlang'ich holatda yashirish
        
        let docsContent = `
            <td colspan="5" class="p-0">
                <div class="documents-section p-3">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0">Hujjatlar ro'yxati</h6>
                        <button class="btn btn-primary btn-sm add-document-btn" data-category-id="${category.id}">
                            <i class="fas fa-plus me-1"></i> Hujjat qo'shish
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm documents-table">
                            <thead>
                                <tr>
                                    <th width="5%" class="text-center">â„–</th>
                                    <th width="50%">Hujjat nomi</th>
                                    <th width="15%">Hujjat yuklangan sana</th>
                                    <th width="15%" class="text-center">Fayl turi</th>
                                    <th width="15%" class="text-center">Amallar</th>
                                </tr>
                            </thead>
                            <tbody>`;
        
        if (category.docs && category.docs.length > 0) {
            category.docs.forEach((doc, index) => {
                const fileExtension = doc.file ? doc.file.split('.').pop().toUpperCase() : 'NOMA\'LUM';
                const fileIcon = getFileIcon(fileExtension);
                
                docsContent += `
                    <tr>
                        <td class="text-center">${index + 1}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <i class="fas fa-file-${fileIcon} me-2 text-primary"></i>
                                <span>${doc.title || 'Nomsiz hujjat'}</span>
                            </div>
                        </td>
                        <td class="text-center">
                            <span >${doc.create_at}</span>
                        </td>
                        <td class="text-center">
                            <span class="badge bg-secondary">${fileExtension}</span>
                        </td>
                        <td class="text-center">
                            <div class="action-buttons">
                                <button class="btn btn-primary btn-sm download-btn" data-file-url="${doc.file || ''}" data-file-name="${doc.title || 'hujjat'}" title="Yuklab olish" ${!doc.file ? 'disabled' : ''}>
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="btn btn-warning btn-sm edit-document-btn" title="Tahrirlash" data-document-id="${doc.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-sm delete-document-btn" title="O'chirish" data-document-id="${doc.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>`;
            });
        } else {
            docsContent += `
                <tr>
                    <td colspan="5" class="text-center text-muted py-3">
                        <i class="fas fa-info-circle me-2"></i>Hujjatlar mavjud emas
                    </td>
                </tr>`;
        }
        
        docsContent += `
                            </tbody>
                        </table>
                    </div>
                </div>
            </td>
        `;
        
        docsRow.innerHTML = docsContent;
        
        // Hujjatlar qatorini kategoriya qatoridan keyin joylashtirish
        const categoryRow = document.querySelector(`.category-row[data-category-id="${category.id}"]`);
        if (categoryRow) {
            categoryRow.insertAdjacentElement('afterend', docsRow);
        } else {
            document.getElementById('tableBody').appendChild(docsRow);
        }
    }
    // Table event listenerlarni qo'shish
    function addTableEventListeners() {
        // Category kengaytirish/kichraytirish
        document.querySelectorAll('.expand-btn').forEach(button => {
            button.addEventListener('click', function() {
                const categoryId = this.getAttribute('data-category-id');
                const docsRow = document.getElementById(`docs-${categoryId}`);
                const icon = this.querySelector('.expand-icon');
                
                if (docsRow) {
                    if (docsRow.style.display === 'none') {
                        docsRow.style.display = '';
                        docsRow.classList.add('show');
                        icon.classList.remove('fa-chevron-down');
                        icon.classList.add('fa-chevron-up');
                    } else {
                        docsRow.style.display = 'none';
                        docsRow.classList.remove('show');
                        icon.classList.remove('fa-chevron-up');
                        icon.classList.add('fa-chevron-down');
                    }
                }
            });
        });

        // Category tahrirlash
        document.querySelectorAll('.edit-category-btn').forEach(button => {
            button.addEventListener('click', function() {
                const categoryId = this.getAttribute('data-category-id');
                editCategory(categoryId);
            });
        });

        // Category o'chirish
        document.querySelectorAll('.delete-category-btn').forEach(button => {
            button.addEventListener('click', function() {
                const categoryId = this.getAttribute('data-category-id');
                showDeleteModal('category', categoryId);
            });
        });

        // Hujjat qo'shish
        document.querySelectorAll('.add-document-btn').forEach(button => {
            button.addEventListener('click', function() {
                currentCategoryForDocument = this.getAttribute('data-category-id');
                currentEditingDocumentId = null;
                document.getElementById('documentModalLabel').textContent = "Hujjat qo'shish";
                document.getElementById('hujjatNomi').value = '';
                document.getElementById('faylTuri').value = '';
                document.getElementById('faylYuklash').value = '';
                document.getElementById('documentId').value = '';
                
                const documentModal = new bootstrap.Modal(document.getElementById('documentModal'));
                documentModal.show();
            });
        });

        // Hujjat tahrirlash
        document.querySelectorAll('.edit-document-btn').forEach(button => {
            button.addEventListener('click', function() {
                const documentId = this.getAttribute('data-document-id');
                editDocument(documentId);
            });
        });

        // Hujjat o'chirish
        document.querySelectorAll('.delete-document-btn').forEach(button => {
            button.addEventListener('click', function() {
                const documentId = this.getAttribute('data-document-id');
                showDeleteModal('document', documentId);
            });
        });

        // Fayl yuklab olish
        document.querySelectorAll('.download-btn').forEach(button => {
            button.addEventListener('click', function() {
                const fileUrl = this.getAttribute('data-file-url');
                const fileName = this.getAttribute('data-file-name');
                downloadFile(fileUrl, fileName);
            });
        });
    }

    // Category tahrirlash
    async function editCategory(categoryId) {
        const AUTH_TOKEN = localStorage.getItem('authToken');
        
        try {
            // Avval kategoriya ma'lumotlarini olish
            const response = await fetch(`${DOCS_LIST_URL}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Token ${AUTH_TOKEN}`,
                    'Content-Type': 'application/json',
                }
            });

            if (!response.ok) {
                throw new Error('Kategoriya ma\'lumotlarini olishda xatolik');
            }

            const data = await response.json();
            let categoryData = null;
            let departmentData = null;
            
            // Kategoriyani qidirish
            data.forEach(department => {
                if (department.categories) {
                    const foundCategory = department.categories.find(cat => cat.id == categoryId);
                    if (foundCategory) {
                        categoryData = foundCategory;
                        departmentData = department;
                    }
                }
            });

            if (!categoryData) {
                alert('Kategoriya topilmadi');
                return;
            }

            // Formani to'ldirish
            document.getElementById('categoryModalLabel').textContent = 'Kategoriyani tahrirlash';
            document.getElementById('categoryId').value = categoryData.id;
            document.getElementById('indeksRaqami').value = categoryData.ichki_raqam || '';
            document.getElementById('jildSarlavhasi').value = categoryData.tartib_raqami || '';
            document.getElementById('izoh').value = categoryData.izoh || '';
            currentEditingCategoryId = categoryId;
            
            // Bo'lim select ni to'ldirish
            populateBigCategorySelect();
            document.getElementById('bigCategory').value = departmentData.id || '';
            
            const categoryModal = new bootstrap.Modal(document.getElementById('categoryModal'));
            categoryModal.show();
            
        } catch (error) {
            console.error('Kategoriyani tahrirlashda xatolik:', error);
            alert('Kategoriya ma\'lumotlarini yuklashda xatolik: ' + error.message);
        }
    }

    // Hujjat tahrirlash
    async function editDocument(documentId) {
        // Hujjat ma'lumotlarini olish uchun API chaqiruvi
        const AUTH_TOKEN = localStorage.getItem('authToken');
        
        try {
            const response = await fetch(`${DOCS_CRUD_URL}${documentId}/`, {
                method: 'GET',
                headers: {
                    'Authorization': `Token ${AUTH_TOKEN}`,
                    'Content-Type': 'application/json',
                }
            });

            if (!response.ok) {
                throw new Error('Hujjat ma\'lumotlarini olishda xatolik');
            }

            const documentData = await response.json();
            
            // Formani to'ldirish
            document.getElementById('documentModalLabel').textContent = 'Hujjatni tahrirlash';
            document.getElementById('hujjatNomi').value = documentData.title || '';
            document.getElementById('faylTuri').value = documentData.file_type || '';
            document.getElementById('documentId').value = documentId;
            currentEditingDocumentId = documentId;
            
            const documentModal = new bootstrap.Modal(document.getElementById('documentModal'));
            documentModal.show();
            
        } catch (error) {
            console.error('Hujjatni tahrirlashda xatolik:', error);
            alert('Hujjat ma\'lumotlarini yuklashda xatolik: ' + error.message);
        }
    }

// SaveCategory funksiyasini yangilaymiz (to'liq tuzatilgan versiya)
async function saveCategory() {
    const bigCategory = document.getElementById('bigCategory').value;
    const indeksRaqami = document.getElementById('indeksRaqami').value;
    const jildSarlavhasi = document.getElementById('jildSarlavhasi').value;
    const izoh = document.getElementById('izoh').value;
    const categoryId = document.getElementById('categoryId').value;
    
    if (!bigCategory || !indeksRaqami || !jildSarlavhasi) {
        showNotification('Barcha majburiy maydonlarni to\'ldirishingiz shart', 'error');
        return;
    }
    
    const saveButton = document.getElementById('saveCategoryBtn');
    const originalText = saveButton.innerHTML;
    saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saqlanmoqda...';
    saveButton.disabled = true;
    
    const AUTH_TOKEN = localStorage.getItem('authToken');
    const url = currentEditingCategoryId ? 
        `${CATEGORY_UPDATE_URL}${currentEditingCategoryId}/` : 
        CATEGORY_CREATE_URL;
    
    const method = currentEditingCategoryId ? 'PUT' : 'POST';
    
    try {
        console.log('Sending request to:', url);
        console.log('Request data:', {
            big_category: parseInt(bigCategory),
            ichki_raqam: indeksRaqami,
            tartib_raqami: jildSarlavhasi,
            izoh: izoh
        });
        
        const response = await fetch(url, {
            method: method,
            headers: {
                'Authorization': `Token ${AUTH_TOKEN}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                big_category: parseInt(bigCategory),
                ichki_raqam: indeksRaqami,
                tartib_raqami: jildSarlavhasi,
                izoh: izoh
            })
        });

        console.log('Response status:', response.status);
        
        // Avval response status'ini tekshiramiz
        if (!response.ok) {
            let errorMessage = 'Saqlashda xatolik';
            let errorData;
            
            try {
                errorData = await response.json();
                console.error('Error response data:', errorData);
                
                if (errorData.error) {
                    errorMessage = errorData.error;
                } else if (errorData.detail) {
                    errorMessage = errorData.detail;
                } else if (errorData.message) {
                    errorMessage = errorData.message;
                } else {
                    // Barcha xatoliklarni array sifatida qabul qilish
                    const errorMessages = [];
                    for (const key in errorData) {
                        if (Array.isArray(errorData[key])) {
                            errorMessages.push(`${key}: ${errorData[key].join(', ')}`);
                        } else {
                            errorMessages.push(`${key}: ${errorData[key]}`);
                        }
                    }
                    if (errorMessages.length > 0) {
                        errorMessage = errorMessages.join(' | ');
                    }
                }
            } catch (e) {
                // JSON parse qila olmasak, status text'ni olamiz
                errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                console.error('JSON parse error:', e);
            }
            
            throw new Error(errorMessage);
        }

        let result;
        // Agar response 204 No Content bo'lsa (PUT operatsiyasi)
        if (response.status === 204) {
            result = { success: true };
        } else {
            // Oddiy response'ni o'qiymiz
            result = await response.json();
        }
        
        console.log('Success response:', result);
        
        // Bildirishnoma ko'rsatish
        if (currentEditingCategoryId) {
            showNotification('Kategoriya muvaffaqiyatli yangilandi', 'success');
            
            // Yangilangan kategoriyadan keyin jadvalni yangilash
            await populateTable();
        } else {
            showNotification('Kategoriya muvaffaqiyatli qo\'shildi', 'success');
            
            // YANGI QO'SHILGAN: Kategoriya qo'shilgandan keyin sahifani yangilash
            setTimeout(() => {
                // Bildirishnoma ko'rinib turganicha 2 soniya kutamiz
                showNotification('Sahifa yangilanmoqda...', 'info');
                
                // 2 soniyadan keyin sahifani yangilaymiz
                setTimeout(() => {
                    location.reload();
                }, 2000);
            }, 500);
        }
        
        // Modalni yopish
        const modalElement = document.getElementById('categoryModal');
        const modal = bootstrap.Modal.getInstance(modalElement);
        if (modal) {
            modal.hide();
        }
        
        // Formani tozalash
        document.getElementById('categoryForm').reset();
        currentEditingCategoryId = null;
        
    } catch (error) {
        console.error('Saqlashda xatolik:', error);
        showNotification('Saqlashda xatolik yuz berdi: ' + error.message, 'error');
        
        // Xatolik haqida qo'shimcha ma'lumot
        if (error.message.includes('big_category') || error.message.includes('ichki_raqam') || error.message.includes('tartib_raqami')) {
            showNotification('Iltimos, barcha maydonlarni to\'g\'ri to\'ldiring', 'error');
        }
        
    } finally {
        // Tugmani qayta faollashtirish
        saveButton.innerHTML = originalText;
        saveButton.disabled = false;
    }
}
// Hujjat saqlash funksiyasini yangilaymiz (to'liq notification bilan)
async function saveDocument() {
    const hujjatNomi = document.getElementById('hujjatNomi').value;
    const faylTuri = document.getElementById('faylTuri').value;
    const faylYuklash = document.getElementById('faylYuklash').files[0];
    const documentId = document.getElementById('documentId').value;
    
    if (!hujjatNomi || !faylTuri) {
        showNotification('Hujjat nomi va fayl turi maydonlari to\'ldirilishi shart', 'error');
        return;
    }
    
    // Agar hujjat yangi bo'lsa va fayl yuklanmasa
    if (!currentEditingDocumentId && !faylYuklash) {
        showNotification('Yangi hujjat uchun fayl yuklashingiz kerak', 'error');
        return;
    }
    
    const saveButton = document.getElementById('saveDocumentBtn');
    const originalText = saveButton.innerHTML;
    saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saqlanmoqda...';
    saveButton.disabled = true;
    
    const AUTH_TOKEN = localStorage.getItem('authToken');
    const url = currentEditingDocumentId ? 
        `${DOCS_CRUD_URL}${currentEditingDocumentId}/` : 
        DOCS_CRUD_URL;
    
    const method = currentEditingDocumentId ? 'PUT' : 'POST';
    
    const formData = new FormData();
    formData.append('title', hujjatNomi);
    formData.append('file_type', faylTuri);
    if (faylYuklash) {
        formData.append('file', faylYuklash);
    }
    if (currentCategoryForDocument) {
        formData.append('category', currentCategoryForDocument);
    }
    
    try {
        const response = await fetch(url, {
            method: method,
            headers: {
                'Authorization': `Token ${AUTH_TOKEN}`,
            },
            body: formData
        });

        if (!response.ok) {
            let errorMessage = 'Saqlashda xatolik';
            try {
                const errorData = await response.json();
                errorMessage = errorData.error || errorData.detail || errorMessage;
            } catch (e) {
                errorMessage = `HTTP ${response.status}: ${response.statusText}`;
            }
            throw new Error(errorMessage);
        }

        const result = await response.json();
        
        // Hujjat qo'shildi/yangilandi notification
        if (currentEditingDocumentId) {
            showNotification(`"${hujjatNomi}" hujjati muvaffaqiyatli yangilandi`, 'success', 'Hujjat yangilandi');
        } else {
            showNotification(`"${hujjatNomi}" hujjati muvaffaqiyatli qo'shildi`, 'success', 'Hujjat qo\'shildi');
        }
        
        // Modalni yopish
        const modal = bootstrap.Modal.getInstance(document.getElementById('documentModal'));
        modal.hide();
        
        // Formani tozalash
        document.getElementById('documentForm').reset();
        document.getElementById('faylYuklash').value = '';
        currentEditingDocumentId = null;
        currentCategoryForDocument = null;
        
        // Jadvalni yangilash
        setTimeout(() => {
            populateTable();
        }, 1000);
        
    } catch (error) {
        console.error('Saqlashda xatolik:', error);
        showNotification('Saqlashda xatolik yuz berdi: ' + error.message, 'error');
    } finally {
        saveButton.innerHTML = originalText;
        saveButton.disabled = false;
    }
}

    // O'chirish modalini ko'rsatish
    function showDeleteModal(type, id) {
        deleteType = type;
        deleteId = id;
        
        const modalText = document.getElementById('deleteModalText');
        if (type === 'category') {
            modalText.textContent = 'Ushbu kategoriyani o\'chirishni tasdiqlaysizmi?';
        } else {
            modalText.textContent = 'Ushbu hujjatni o\'chirishni tasdiqlaysizmi?';
        }
        
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        deleteModal.show();
    }

// O'chirishni tasdiqlash (notification bilan)
async function confirmDelete() {
    const AUTH_TOKEN = localStorage.getItem('authToken');
    
    try {
        let url;
        
        if (deleteType === 'category') {
            // Kategoriya o'chirish
            url = `${CATEGORY_DELETE_URL}${deleteId}/`;
        } else {
            // Hujjat o'chirish
            url = `${DOCS_CRUD_URL}`;
        }
        
        let requestOptions = {
            method: 'DELETE',
            headers: {
                'Authorization': `Token ${AUTH_TOKEN}`,
                'Content-Type': 'application/json',
            }
        };
        
        // Faqat hujjat uchun body qo'shamiz
        if (deleteType === 'document') {
            requestOptions.body = JSON.stringify({ ids: [parseInt(deleteId)] });
        }
        
        const response = await fetch(url, requestOptions);

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || errorData.detail || 'O\'chirishda xatolik');
        }

        let result;
        if (response.status !== 204) {
            result = await response.json();
        }
        
        // O'chirish muvaffaqiyatli bo'lsa notification ko'rsatish
        if (deleteType === 'category') {
            showNotification('Kategoriya muvaffaqiyatli o\'chirildi', 'success', 'O\'chirildi');
        } else {
            showNotification('Hujjat muvaffaqiyatli o\'chirildi', 'success', 'O\'chirildi');
        }
        
        // Modalni yopish
        const modal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
        modal.hide();
        
        // Jadvalni yangilash
        setTimeout(() => {
            populateTable();
        }, 1000);
        
    } catch (error) {
        console.error('O\'chirishda xatolik:', error);
        showNotification('O\'chirishda xatolik yuz berdi: ' + error.message, 'error');
    }
}
    // Faylni yuklab olish funksiyasi
    function downloadFile(filePath, fileName) {
        if (!filePath) {
            alert('Fayl manzili mavjud emas');
            return;
        }
        
        // Haqiqiy yuklab olish
        const link = document.createElement('a');
        link.href = filePath;
        link.download = fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // Izoh matnini formatlash
    function formatIzoh(izoh) {
        if (!izoh) return '';
        return izoh.replace(/\r\n/g, '<br>').replace(/\n/g, '<br>');
    }

    // Fayl ikonkasini aniqlash funksiyasi
    function getFileIcon(extension) {
        const iconMap = {
            'PDF': 'pdf',
            'DOC': 'word',
            'DOCX': 'word',
            'PPT': 'powerpoint',
            'PPTX': 'powerpoint',
            'XLS': 'excel',
            'XLSX': 'excel',
            'TXT': 'alt',
            'ZIP': 'archive',
            'RAR': 'archive',
            'NOMA\'LUM': 'question'
        };
        return iconMap[extension] || 'alt';
    }

    // Qidiruv funksiyasi
    function setupSearch() {
        const searchInput = document.getElementById('globalSearch');
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('.category-row');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
        });
    }

    // Logout funksiyalari
    function logout() {
        const logoutModal = new bootstrap.Modal(document.getElementById('logoutModal'));
        logoutModal.show();
    }

    function confirmLogout() {
        localStorage.removeItem('authToken');
        localStorage.removeItem('userData');
        const logoutModal = bootstrap.Modal.getInstance(document.getElementById('logoutModal'));
        logoutModal.hide();
        window.location.href = 'login.html';
    }

    // Yuklanish ko'rsatkichini ko'rsatish/yashirish
    function showLoading() {
        document.getElementById('loadingSpinner').style.display = 'block';
        document.getElementById('tableBody').style.display = 'none';
    }

    function hideLoading() {
        document.getElementById('loadingSpinner').style.display = 'none';
        document.getElementById('tableBody').style.display = '';
    }

    // Xatolik xabarini ko'rsatish/yashirish
    function showError(message) {
        document.getElementById('errorText').textContent = message;
        document.getElementById('errorMessage').style.display = 'block';
        document.getElementById('tableBody').style.display = 'none';
    }

    function hideError() {
        document.getElementById('errorMessage').style.display = 'none';
    }

    // Yangilash tugmasi
    function refreshData() {
        populateTable();
    }

    // Filtrlash funksiyasi (demo)
    function applyFilters() {
        alert('Filtrlash funksiyasi ishlatilmoqda...');
    }
</script>
</body>
</html>