<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Archive Monitoring Dashboard</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#3B82F6", // Blue from screenshot
                        secondary: "#F97316", // Orange accent
                        "background-light": "#F3F4F6",
                        "background-dark": "#111827",
                        "surface-light": "#FFFFFF",
                        "surface-dark": "#1F2937",
                        "text-light": "#1F2937",
                        "text-dark": "#F9FAFB",
                        "muted-light": "#6B7280",
                        "muted-dark": "#9CA3AF",
                        "border-light": "#E5E7EB",
                        "border-dark": "#374151",
                    },
                    fontFamily: {
                        display: ["Inter", "sans-serif"],
                        body: ["Inter", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "0.5rem",
                    },
                },
            },
        };
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4b5563;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Loading spinner styles */
        .spinner {
            border: 3px solid rgba(59, 130, 246, 0.1);
            border-radius: 50%;
            border-top: 3px solid #3B82F6;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* File type icons color */
        .pdf-icon { color: #e74c3c; }
        .doc-icon { color: #2c3e50; }
        .xls-icon { color: #27ae60; }
        .img-icon { color: #9b59b6; }
        .default-icon { color: #7f8c8d; }
        
        /* Modal styles */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* Table row hover */
        .table-row-hover:hover {
            background-color: rgba(59, 130, 246, 0.05);
        }
        
        /* Collapse transition */
        .collapse-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapse-content.expanded {
            max-height: 2000px;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark font-body antialiased transition-colors duration-200">
<div class="flex h-screen overflow-hidden">
    
    <!-- Sidebar -->
    <aside class="w-64 flex-shrink-0 hidden md:flex flex-col bg-surface-light dark:bg-surface-dark border-r border-border-light dark:border-border-dark transition-all duration-300">
        <div class="h-16 flex items-center px-6 border-b border-border-light dark:border-border-dark">
            <div class="flex items-center gap-3">
                <div class="bg-primary text-white p-1.5 rounded-lg">
                    <span class="material-icons-outlined text-xl">inventory_2</span>
                </div>
                <span class="text-xl font-bold tracking-tight text-text-light dark:text-text-dark">arxiv.</span>
            </div>
            <button class="ml-auto text-muted-light dark:text-muted-dark hover:text-primary transition-colors" onclick="toggleSidebar()">
                <span class="material-icons-outlined">menu_open</span>
            </button>
        </div>
        <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
            <div class="mb-6">
                <a class="flex items-center justify-between px-4 py-3 bg-blue-50 dark:bg-blue-900/20 text-primary rounded-xl transition-colors" href="#" onclick="toggleSubMenu(event)">
                    <div class="flex items-center gap-3">
                        <span class="material-icons-outlined">dashboard</span>
                        <span class="font-medium">Boshqaruv paneli</span>
                    </div>
                    <span class="material-icons-outlined text-sm transition-transform" id="subMenuIcon">expand_more</span>
                </a>
                <div class="mt-2 pl-4 space-y-1 collapse-content" id="subMenu">
                    <a class="flex items-center gap-3 px-4 py-2 text-sm text-primary font-medium rounded-lg" href="#">
                        <span class="w-1.5 h-1.5 bg-primary rounded-full"></span>
                        Bosh sahifa
                    </a>
                    <a class="flex items-center gap-3 px-4 py-2 text-sm text-muted-light dark:text-muted-dark hover:text-primary dark:hover:text-primary hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-lg transition-colors" href="#">
                        <span class="w-1.5 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"></span>
                        Hujjatlar
                    </a>
                    <a class="flex items-center gap-3 px-4 py-2 text-sm text-muted-light dark:text-muted-dark hover:text-primary dark:hover:text-primary hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-lg transition-colors" href="#">
                        <span class="w-1.5 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"></span>
                        Xodimlar
                    </a>
                </div>
            </div>
            <div class="pt-4 border-t border-border-light dark:border-border-dark">
                <a class="flex items-center gap-3 px-4 py-3 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-colors cursor-pointer" onclick="showLogoutModal()">
                    <span class="material-icons-outlined">logout</span>
                    <span class="font-medium">Chiqish</span>
                </a>
            </div>
        </nav>
        <div class="p-4 mt-auto">
            <div class="bg-gradient-to-br from-primary to-blue-600 rounded-2xl p-5 text-white relative overflow-hidden shadow-lg">
                <div class="absolute top-0 right-0 -mt-2 -mr-2 w-16 h-16 bg-white opacity-10 rounded-full blur-xl"></div>
                <div class="absolute bottom-0 left-0 -mb-2 -ml-2 w-12 h-12 bg-white opacity-10 rounded-full blur-xl"></div>
                <h4 class="font-bold text-sm mb-2 relative z-10">Hujjatlarni izlash va boshqarish</h4>
                <p class="text-xs text-blue-100 mb-4 relative z-10 leading-relaxed">Endi yanada oson va qulay interfeysda.</p>
                <button class="w-full bg-white text-primary text-xs font-semibold py-2 px-4 rounded-lg shadow-sm hover:shadow-md transition-shadow relative z-10">
                    Batafsil
                </button>
                <div class="absolute bottom-0 right-0 w-16 h-16 opacity-20 transform translate-x-2 translate-y-2">
                    <span class="material-icons-outlined text-6xl text-white">analytics</span>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full overflow-hidden bg-background-light dark:bg-background-dark relative">
        <!-- Header -->
        <header class="h-16 flex items-center justify-between px-6 bg-surface-light dark:bg-surface-dark border-b border-border-light dark:border-border-dark flex-shrink-0 z-20">
            <div class="flex-1 max-w-xl">
                <div class="relative">
                    <span class="material-icons-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-light dark:text-muted-dark">search</span>
                    <input 
                        class="w-full pl-10 pr-4 py-2 bg-gray-50 dark:bg-gray-800 border-none rounded-xl text-sm focus:ring-2 focus:ring-primary/20 text-text-light dark:text-text-dark placeholder-muted-light dark:placeholder-muted-dark" 
                        placeholder="Ma'lumot qidirish" 
                        type="text"
                        id="globalSearch"
                    />
                </div>
            </div>
            <div class="flex items-center gap-4 ml-6">
                <button class="p-2 text-muted-light dark:text-muted-dark hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors" onclick="toggleDarkMode()">
                    <span class="material-icons-outlined" id="themeIcon">dark_mode</span>
                </button>
                <div class="relative">
                    <button class="p-2 text-muted-light dark:text-muted-dark hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors" onclick="toggleNotifications()">
                        <span class="material-icons-outlined">notifications</span>
                    </button>
                    <span class="absolute top-1.5 right-1.5 w-4 h-4 bg-primary text-white text-[10px] flex items-center justify-center rounded-full font-bold border-2 border-surface-light dark:border-surface-dark" id="notificationCount">4</span>
                </div>
                <div class="flex items-center gap-3 pl-4 border-l border-border-light dark:border-border-dark">
                    <div class="text-right hidden sm:block">
                        <p class="text-sm font-bold text-text-light dark:text-text-dark" id="userName">Yuklanmoqda...</p>
                        <p class="text-xs text-muted-light dark:text-muted-dark" id="userPhone">Yuklanmoqda...</p>
                    </div>
                    <div class="w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden border-2 border-white dark:border-gray-600 shadow-sm">
                        <span class="material-icons-outlined text-gray-500 dark:text-gray-400" id="userAvatarIcon">person</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-6 md:p-8">
            <div class="mb-8">
                <h1 class="text-2xl font-bold text-text-light dark:text-text-dark mb-1">Monitoring paneli</h1>
                <p class="text-sm text-muted-light dark:text-muted-dark">Tizimdagi umumiy holat va statistika</p>
            </div>

            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">
                <div class="bg-surface-light dark:bg-surface-dark p-8 rounded-2xl shadow-sm border border-border-light dark:border-border-dark flex items-start justify-between hover:shadow-md transition-shadow group">
                    <div>
                        <p class="text-base font-medium text-muted-light dark:text-muted-dark mb-3">Bo'limlar</p>
                        <h3 class="text-4xl font-bold text-text-light dark:text-text-dark group-hover:text-primary transition-colors" id="departmentsCount">0</h3>
                    </div>
                    <div class="p-4 bg-blue-50 dark:bg-blue-900/30 rounded-xl text-primary">
                        <span class="material-icons-outlined text-3xl">layers</span>
                    </div>
                </div>
                <div class="bg-surface-light dark:bg-surface-dark p-8 rounded-2xl shadow-sm border border-border-light dark:border-border-dark flex items-start justify-between hover:shadow-md transition-shadow group">
                    <div>
                        <p class="text-base font-medium text-muted-light dark:text-muted-dark mb-3">Hujjatlar</p>
                        <h3 class="text-4xl font-bold text-text-light dark:text-text-dark group-hover:text-green-500 transition-colors" id="documentsCount">0</h3>
                    </div>
                    <div class="p-4 bg-green-50 dark:bg-green-900/30 rounded-xl text-green-500">
                        <span class="material-icons-outlined text-3xl">description</span>
                    </div>
                </div>
                <div class="bg-surface-light dark:bg-surface-dark p-8 rounded-2xl shadow-sm border border-border-light dark:border-border-dark flex items-start justify-between hover:shadow-md transition-shadow group">
                    <div>
                        <p class="text-base font-medium text-muted-light dark:text-muted-dark mb-3">Xodimlar</p>
                        <h3 class="text-4xl font-bold text-text-light dark:text-text-dark group-hover:text-orange-500 transition-colors" id="employeesCount">0</h3>
                    </div>
                    <div class="p-4 bg-orange-50 dark:bg-orange-900/30 rounded-xl text-orange-500">
                        <span class="material-icons-outlined text-3xl">groups</span>
                    </div>
                </div>
                <div class="bg-surface-light dark:bg-surface-dark p-8 rounded-2xl shadow-sm border border-border-light dark:border-border-dark flex items-start justify-between hover:shadow-md transition-shadow group">
                    <div>
                        <p class="text-base font-medium text-muted-light dark:text-muted-dark mb-3">Yig'ma jildlar</p>
                        <h3 class="text-4xl font-bold text-text-light dark:text-text-dark group-hover:text-purple-500 transition-colors" id="foldersCount">0</h3>
                    </div>
                    <div class="p-4 bg-purple-50 dark:bg-purple-900/30 rounded-xl text-purple-500">
                        <span class="material-icons-outlined text-3xl">folder</span>
                    </div>
                </div>
            </div>

            <!-- Documents Table Section -->
            <div class="bg-surface-light dark:bg-surface-dark rounded-2xl shadow-sm border border-border-light dark:border-border-dark overflow-hidden">
                <!-- Filters -->
                <div class="p-5 border-b border-border-light dark:border-border-dark flex flex-col sm:flex-row gap-4 justify-between items-center bg-gray-50/50 dark:bg-gray-800/20">
                    <div class="relative w-full sm:w-96">
                        <span class="material-icons-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-light dark:text-muted-dark text-lg">search</span>
                        <input 
                            class="w-full pl-10 pr-4 py-2 bg-white dark:bg-gray-800 border border-border-light dark:border-border-dark rounded-lg text-sm focus:ring-2 focus:ring-primary/20 focus:border-primary text-text-light dark:text-text-dark placeholder-muted-light dark:placeholder-muted-dark shadow-sm" 
                            placeholder="Ma'lumot qidirish..." 
                            type="text"
                            id="searchInput"
                        />
                    </div>
                    <div class="flex flex-wrap gap-3 w-full sm:w-auto">
                        <select 
                            class="form-select px-4 py-2 text-sm border-border-light dark:border-border-dark rounded-lg bg-white dark:bg-gray-800 text-text-light dark:text-text-dark shadow-sm focus:ring-primary focus:border-primary"
                            id="departmentFilter"
                        >
                            <option value="">Bo'lim</option>
                            <option value="all">Barchasi</option>
                            <!-- Bo'limlar JavaScript orqali to'ldiriladi -->
                        </select>
                        <select 
                            class="form-select px-4 py-2 text-sm border-border-light dark:border-border-dark rounded-lg bg-white dark:bg-gray-800 text-text-light dark:text-text-dark shadow-sm focus:ring-primary focus:border-primary"
                            id="dateFilter"
                        >
                            <option value="">Sana</option>
                            <option value="7">Oxirgi 7 kun</option>
                            <option value="30">Oxirgi 30 kun</option>
                            <option value="90">Oxirgi 3 oy</option>
                        </select>
                        <button 
                            class="bg-secondary hover:bg-orange-600 text-white p-2 rounded-lg shadow-sm transition-colors flex items-center justify-center"
                            onclick="refreshData()"
                        >
                            <span class="material-icons-outlined text-lg">refresh</span>
                        </button>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div id="loadingSpinner" class="p-8 text-center">
                    <div class="spinner mx-auto"></div>
                    <p class="mt-4 text-muted-light dark:text-muted-dark">Ma'lumotlar yuklanmoqda...</p>
                </div>

                <!-- Error Message -->
                <div id="errorMessage" class="hidden p-4 m-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
                    <div class="flex items-center">
                        <span class="material-icons-outlined text-red-500 mr-2">error</span>
                        <p class="text-red-700 dark:text-red-300" id="errorText">Ma'lumotlarni yuklashda xatolik yuz berdi</p>
                    </div>
                </div>

                <!-- Table Headers -->
                <div class="grid grid-cols-12 gap-4 px-6 py-3 bg-gray-50/80 dark:bg-gray-800/40 border-b border-border-light dark:border-border-dark text-xs font-semibold text-muted-light dark:text-muted-dark uppercase tracking-wider">
                    <div class="col-span-1 text-center">No</div>
                    <div class="col-span-2">Indeks Raqami</div>
                    <div class="col-span-5">Yig'ma Jild Sarlavhasi</div>
                    <div class="col-span-2">Izoh</div>
                    <div class="col-span-2 text-right">Amallar</div>
                </div>

                <!-- Departments Table (will be populated by JavaScript) -->
                <div id="tableBody">
                    <!-- Data will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Floating Buttons -->
    <div class="fixed bottom-6 right-6 flex flex-col gap-3">
        <button class="w-12 h-12 bg-teal-400 hover:bg-teal-500 text-white rounded-full shadow-lg flex items-center justify-center transition-all hover:scale-110">
            <span class="material-icons-outlined">headset_mic</span>
        </button>
        <button class="w-12 h-12 bg-green-500 hover:bg-green-600 text-white rounded-full shadow-lg flex items-center justify-center transition-all hover:scale-110">
            <span class="material-icons-outlined">shopping_cart</span>
        </button>
    </div>
</div>

<!-- Logout Confirmation Modal -->
<div id="logoutModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 transition-opacity modal-backdrop" aria-hidden="true"></div>
        
        <!-- Modal panel -->
        <div class="inline-block align-bottom bg-surface-light dark:bg-surface-dark rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <div class="px-6 pt-6">
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/30">
                        <span class="material-icons-outlined text-red-600 dark:text-red-400 text-2xl">logout</span>
                    </div>
                    <h3 class="mt-4 text-lg font-semibold text-text-light dark:text-text-dark">Tizimdan chiqish</h3>
                    <div class="mt-2">
                        <p class="text-sm text-muted-light dark:text-muted-dark">Rostan ham tizimdan chiqmoqchimisiz?</p>
                        <p class="text-xs text-muted-light dark:text-muted-dark mt-1">Agar chiqsangiz, qayta kirish uchun login qilishingiz kerak bo'ladi.</p>
                    </div>
                </div>
            </div>
            <div class="px-6 py-4 bg-gray-50 dark:bg-gray-800/50 flex justify-center gap-3">
                <button 
                    type="button" 
                    class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg transition-colors"
                    onclick="hideLogoutModal()"
                >
                    Bekor qilish
                </button>
                <button 
                    type="button" 
                    class="px-4 py-2 text-sm font-medium text-white bg-red-500 hover:bg-red-600 rounded-lg transition-colors flex items-center gap-2"
                    onclick="confirmLogout()"
                >
                    <span class="material-icons-outlined text-sm">logout</span>
                    Ha, chiqish
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Document View Modal -->
<div id="documentViewModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 transition-opacity modal-backdrop" aria-hidden="true"></div>
        
        <!-- Modal panel -->
        <div class="inline-block align-bottom bg-surface-light dark:bg-surface-dark rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-5xl sm:w-full">
            <div class="px-6 pt-6 pb-4 border-b border-border-light dark:border-border-dark">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <span class="material-icons-outlined text-primary">description</span>
                        <h3 class="text-lg font-semibold text-text-light dark:text-text-dark" id="modalDocumentTitle">Hujjatni ko'rish</h3>
                    </div>
                    <button 
                        type="button" 
                        class="text-muted-light dark:text-muted-dark hover:text-text-light dark:hover:text-text-dark"
                        onclick="hideDocumentModal()"
                    >
                        <span class="material-icons-outlined">close</span>
                    </button>
                </div>
            </div>
            <div class="px-6 py-4">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div>
                        <h4 class="text-sm font-medium text-text-light dark:text-text-dark mb-3">Hujjat ma'lumotlari:</h4>
                        <div class="space-y-2">
                            <div class="grid grid-cols-3 gap-2 text-sm">
                                <span class="text-muted-light dark:text-muted-dark">Hujjat nomi:</span>
                                <span class="col-span-2 font-medium" id="modalDocName">-</span>
                            </div>
                            <div class="grid grid-cols-3 gap-2 text-sm">
                                <span class="text-muted-light dark:text-muted-dark">Fayl turi:</span>
                                <span class="col-span-2 font-medium" id="modalFileType">-</span>
                            </div>
                            <div class="grid grid-cols-3 gap-2 text-sm">
                                <span class="text-muted-light dark:text-muted-dark">Yaratilgan sana:</span>
                                <span class="col-span-2 font-medium" id="modalCreateDate">-</span>
                            </div>
                            <div class="grid grid-cols-3 gap-2 text-sm">
                                <span class="text-muted-light dark:text-muted-dark">Bo'lim:</span>
                                <span class="col-span-2 font-medium" id="modalDepartment">-</span>
                            </div>
                            <div class="grid grid-cols-3 gap-2 text-sm">
                                <span class="text-muted-light dark:text-muted-dark">Kategoriya:</span>
                                <span class="col-span-2 font-medium" id="modalCategory">-</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-text-light dark:text-text-dark mb-3">Fayl manzili:</h4>
                        <div class="flex gap-2 mb-4">
                            <input 
                                type="text" 
                                class="flex-1 px-3 py-2 text-sm border border-border-light dark:border-border-dark rounded-lg bg-gray-50 dark:bg-gray-800 text-text-light dark:text-text-dark"
                                id="modalFileUrl" 
                                readonly
                            />
                            <button 
                                class="px-3 py-2 text-sm border border-border-light dark:border-border-dark rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                                onclick="copyFileUrl()"
                            >
                                <span class="material-icons-outlined text-sm">content_copy</span>
                            </button>
                        </div>
                        <div class="space-y-3">
                            <button 
                                class="w-full px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-blue-600 rounded-lg transition-colors flex items-center justify-center gap-2"
                                onclick="downloadFromModal()"
                            >
                                <span class="material-icons-outlined text-sm">download</span>
                                Yuklab olish
                            </button>
                            <button 
                                class="w-full px-4 py-2 text-sm font-medium text-primary border border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors flex items-center justify-center gap-2"
                                onclick="openFileInNewTab()"
                            >
                                <span class="material-icons-outlined text-sm">open_in_new</span>
                                Yangi oynada ochish
                            </button>
                        </div>
                    </div>
                </div>
                <div class="border border-border-light dark:border-border-dark rounded-lg p-4">
                    <h4 class="text-sm font-medium text-text-light dark:text-text-dark mb-3">Fayl kontenti:</h4>
                    <div id="modalFileContent" class="text-center p-8">
                        <div class="spinner mx-auto"></div>
                        <p class="mt-4 text-muted-light dark:text-muted-dark">Fayl yuklanmoqda...</p>
                    </div>
                </div>
            </div>
            <div class="px-6 py-4 bg-gray-50 dark:bg-gray-800/50 flex justify-end">
                <button 
                    type="button" 
                    class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg transition-colors"
                    onclick="hideDocumentModal()"
                >
                    Yopish
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Global variables
let allData = [];
let currentDepartment = '';
let modalDocumentData = {};
let openDepartmentId = null;
let currentFilters = {
    department: '',
    documentType: '',
    dateFilter: ''
};
const BASE_API_URL = 'https://backend-arxiv.tmsiti.uz/api/v1/docs/list/';
const PROFILE_API_URL = 'https://backend-arxiv.tmsiti.uz/api/v1/my-profile/';

// Authentication check
function checkAuth() {
    const token = localStorage.getItem('authToken');
    if (!token) {
        window.location.href = 'login.html';
        return false;
    }
    return true;
}

// Initialize application
document.addEventListener('DOMContentLoaded', function() {
    if (!checkAuth()) return;
    
    loadUserProfile();
    populateTable();
    setupSearch();
    setupFilterEvents();
    
    // Check for saved theme preference
    if (localStorage.getItem('darkMode') === 'true') {
        document.documentElement.classList.add('dark');
        document.getElementById('themeIcon').textContent = 'light_mode';
    }
});

// Load user profile
async function loadUserProfile() {
    const token = localStorage.getItem('authToken');
    
    try {
        const response = await fetch(PROFILE_API_URL, {
            method: 'GET',
            headers: {
                'Authorization': `Token ${token}`,
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) throw new Error('Profile yuklashda xatolik');
        
        const userData = await response.json();
        updateUserInfo(userData);
    } catch (error) {
        console.error('Foydalanuvchi ma\'lumotlarini yuklashda xatolik:', error);
        const storedUserData = localStorage.getItem('userData');
        if (storedUserData) {
            updateUserInfo(JSON.parse(storedUserData));
        }
    }
}

// Update user info in UI
function updateUserInfo(userData) {
    const userNameElement = document.getElementById('userName');
    const userPhoneElement = document.getElementById('userPhone');
    
    if (userNameElement && userData.full_name) {
        userNameElement.textContent = userData.full_name;
    }
    
    if (userPhoneElement && userData.phone) {
        userPhoneElement.textContent = userData.phone;
    }
    
    localStorage.setItem('userData', JSON.stringify(userData));
}

// Setup filter events
function setupFilterEvents() {
    document.getElementById('departmentFilter').addEventListener('change', async function() {
        const departmentTitle = this.value;
        await filterByDepartmentAPI(departmentTitle);
    });

    document.getElementById('documentTypeFilter').addEventListener('change', function() {
        currentFilters.documentType = this.value;
        applyClientSideFilters();
    });

    document.getElementById('dateFilter').addEventListener('change', function() {
        currentFilters.dateFilter = this.value;
        applyClientSideFilters();
    });
}

// Populate table with data
async function populateTable(filters = {}) {
    showLoading();
    hideError();

    const AUTH_TOKEN = localStorage.getItem('authToken');
    
    if (!AUTH_TOKEN) {
        showError('Siz tizimga kirmagansiz. Iltimos, qaytadan kiring.');
        hideLoading();
        window.location.href = 'login.html';
        return;
    }

    try {
        let apiUrl = BASE_API_URL;
        const params = new URLSearchParams();
        
        if (filters.departmentTitle && filters.departmentTitle !== 'all') {
            params.append('title', filters.departmentTitle);
        }
        
        if (params.toString()) {
            apiUrl += '?' + params.toString();
        }

        const response = await fetch(apiUrl, {
            method: 'GET',
            headers: {
                'Authorization': `Token ${AUTH_TOKEN}`,
                'Content-Type': 'application/json',
            }
        });

        if (!response.ok) {
            if (response.status === 401) {
                localStorage.removeItem('authToken');
                localStorage.removeItem('userData');
                window.location.href = 'login.html';
                return;
            }
            throw new Error(`HTTP xatolik! Status: ${response.status}`);
        }

        const data = await response.json();
        
        if (filters.departmentTitle && filters.departmentTitle !== 'all') {
            allData = Array.isArray(data) ? data : [data];
        } else {
            allData = data;
        }
        
        renderTable(allData);
        updateStatistics(allData);
        populateDepartmentFilter(allData);
        hideLoading();

    } catch (error) {
        console.error('Ma\'lumotlarni yuklashda xatolik:', error);
        showError('Ma\'lumotlarni yuklashda xatolik yuz berdi: ' + error.message);
        hideLoading();
    }
}

// Populate department filter dropdown
function populateDepartmentFilter(departments) {
    const departmentFilter = document.getElementById('departmentFilter');
    if (!departmentFilter) return;
    
    const currentValue = departmentFilter.value;
    departmentFilter.innerHTML = `
        <option value="">Bo'lim</option>
        <option value="all">Barchasi</option>
    `;
    
    departments.forEach(dept => {
        const option = document.createElement('option');
        option.value = dept.title;
        option.textContent = dept.title;
        departmentFilter.appendChild(option);
    });
    
    if (currentValue) {
        departmentFilter.value = currentValue;
    }
}

// Filter by department using API
async function filterByDepartmentAPI(departmentTitle) {
    currentDepartment = departmentTitle;
    currentFilters.department = departmentTitle;
    
    if (!departmentTitle || departmentTitle === 'all') {
        await populateTable({});
        return;
    }
    
    showLoading();
    await populateTable({ departmentTitle: departmentTitle });
}

// Apply client-side filters
function applyClientSideFilters() {
    let filteredData = [...allData];
    
    if (currentFilters.documentType) {
        filteredData = filterByDocumentType(filteredData, currentFilters.documentType);
    }
    
    if (currentFilters.dateFilter) {
        filteredData = filterByDate(filteredData, parseInt(currentFilters.dateFilter));
    }
    
    renderTable(filteredData);
}

// Filter by document type
function filterByDocumentType(data, docType) {
    return data.map(dept => {
        const filteredDept = { ...dept };
        
        if (filteredDept.categories && filteredDept.categories.length > 0) {
            filteredDept.categories = filteredDept.categories.map(category => {
                const filteredCategory = { ...category };
                
                if (filteredCategory.docs && filteredCategory.docs.length > 0) {
                    filteredCategory.docs = filteredCategory.docs.filter(doc => {
                        if (!doc.file) return false;
                        const fileExt = doc.file.split('.').pop().toLowerCase();
                        return fileExt === docType;
                    });
                }
                
                return filteredCategory;
            });
        }
        
        return filteredDept;
    });
}

// Filter by date
function filterByDate(data, days) {
    const cutoffDate = new Date();
    cutoffDate.setDate(cutoffDate.getDate() - days);
    
    return data.map(dept => {
        const filteredDept = { ...dept };
        
        if (filteredDept.categories && filteredDept.categories.length > 0) {
            filteredDept.categories = filteredDept.categories.map(category => {
                const filteredCategory = { ...category };
                
                if (filteredCategory.docs && filteredCategory.docs.length > 0) {
                    filteredCategory.docs = filteredCategory.docs.filter(doc => {
                        if (!doc.create_at) return false;
                        const docDate = new Date(doc.create_at);
                        return docDate >= cutoffDate;
                    });
                }
                
                return filteredCategory;
            });
        }
        
        return filteredDept;
    });
}

// Update statistics
function updateStatistics(data) {
    let totalDepartments = 0;
    let totalDocuments = 0;
    let totalCategories = 0;

    if (data && data.length > 0) {
        totalDepartments = data.length;
        
        data.forEach(department => {
            if (department.categories && department.categories.length > 0) {
                totalCategories += department.categories.length;
                
                department.categories.forEach(category => {
                    if (category.docs && category.docs.length > 0) {
                        totalDocuments += category.docs.length;
                    }
                });
            }
        });
    }

    document.getElementById('departmentsCount').textContent = totalDepartments;
    document.getElementById('documentsCount').textContent = totalDocuments;
    document.getElementById('employeesCount').textContent = '63'; // Static value
    document.getElementById('foldersCount').textContent = totalCategories;
}

// Render table
function renderTable(data) {
    const tableBody = document.getElementById('tableBody');
    tableBody.innerHTML = '';
    
    if (!data || data.length === 0) {
        tableBody.innerHTML = `
            <div class="p-8 text-center text-muted-light dark:text-muted-dark">
                <span class="material-icons-outlined text-4xl mb-2">search_off</span>
                <p>Ma'lumotlar topilmadi</p>
            </div>
        `;
        return;
    }

    data.forEach((department, deptIndex) => {
        // Department row
        const deptRow = document.createElement('div');
        deptRow.className = `group border-b border-border-light dark:border-border-dark last:border-0 hover:bg-blue-50/30 dark:hover:bg-blue-900/10 transition-colors ${currentDepartment === department.title ? 'bg-blue-50/50 dark:bg-blue-900/20' : ''}`;
        deptRow.innerHTML = `
            <div class="grid grid-cols-12 gap-4 px-6 py-4 items-center cursor-pointer" data-dept-id="${department.id}">
                <div class="col-span-8 flex items-center gap-3">
                    <div class="p-1.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-400 rounded">
                        <span class="material-icons-outlined text-lg">business</span>
                    </div>
                    <span class="font-semibold text-text-light dark:text-text-dark text-sm">${department.title}</span>
                </div>
                <div class="col-span-4 flex justify-end">
                    <span class="material-icons-outlined text-muted-light dark:text-muted-dark group-hover:text-primary transition-all duration-300" id="deptIcon-${department.id}">expand_more</span>
                </div>
            </div>
            <div class="collapse-content" id="deptContent-${department.id}">
                <!-- Categories will be loaded here -->
            </div>
        `;
        tableBody.appendChild(deptRow);
        
        // Add event listener to department header
        setTimeout(() => {
            const deptHeader = deptRow.querySelector(`[data-dept-id="${department.id}"]`);
            if (deptHeader) {
                deptHeader.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleDepartment(department.id);
                });
            }
        }, 50);
        
        // Preload categories content
        setTimeout(() => {
            loadCategoriesContent(department, deptIndex);
        }, 100);
    });
}

// Load categories content for a department
function loadCategoriesContent(department, deptIndex) {
    const contentDiv = document.getElementById(`deptContent-${department.id}`);
    if (!contentDiv) return;
    
    let html = '<div class="px-6 py-4 bg-gray-50/30 dark:bg-gray-800/20">';
    
    if (department.categories && department.categories.length > 0) {
        let rowCount = 1;
        
        department.categories.forEach((category, catIndex) => {
            const categoryId = `category-${department.id}-${category.id}`;
            html += `
                <div class="mb-4 last:mb-0">
                    <div class="grid grid-cols-12 gap-4 px-4 py-3 bg-white dark:bg-gray-800 rounded-lg border border-border-light dark:border-border-dark cursor-pointer hover:shadow-sm transition-shadow" data-cat-id="${categoryId}">
                        <div class="col-span-1 text-center font-medium">${rowCount++}</div>
                        <div class="col-span-2 font-medium">${category.ichki_raqam || 'N/A'}</div>
                        <div class="col-span-5">${category.tartib_raqami || 'N/A'}</div>
                        <div class="col-span-2">${formatIzoh(category.izoh)}</div>
                        <div class="col-span-2 text-right">
                            <button class="px-3 py-1 text-sm text-primary border border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors">
                                <span class="material-icons-outlined text-sm align-middle">expand_more</span>
                                Ko'rish
                            </button>
                        </div>
                    </div>
                    <div class="collapse-content mt-2" id="catContent-${department.id}-${category.id}">
                        <!-- Documents will be loaded here -->
                    </div>
                </div>
            `;
            
            // Add event listener to category header
            setTimeout(() => {
                const catHeader = document.querySelector(`[data-cat-id="${categoryId}"]`);
                if (catHeader) {
                    catHeader.addEventListener('click', function(e) {
                        e.stopPropagation();
                        toggleCategory(department.id, category.id);
                    });
                }
            }, 50);
            
            // Preload documents content
            setTimeout(() => {
                loadDocumentsContent(department.id, category);
            }, 100);
        });
    } else {
        html += `
            <div class="text-center py-6 text-muted-light dark:text-muted-dark">
                <span class="material-icons-outlined text-3xl mb-2">folder_off</span>
                <p>Kategoriyalar mavjud emas</p>
            </div>
        `;
    }
    
    html += '</div>';
    contentDiv.innerHTML = html;
}

// Load documents content for a category
function loadDocumentsContent(deptId, category) {
    const contentDiv = document.getElementById(`catContent-${deptId}-${category.id}`);
    if (!contentDiv) return;
    
    let html = '<div class="ml-6 mr-2 p-4 bg-white dark:bg-gray-800 rounded-lg border border-border-light dark:border-border-dark">';
    
    if (category.docs && category.docs.length > 0) {
        html += `
            <div class="grid grid-cols-12 gap-4 px-4 py-2 mb-2 text-xs font-semibold text-muted-light dark:text-muted-dark uppercase tracking-wider border-b border-border-light dark:border-border-dark">
                <div class="col-span-1 text-center">No</div>
                <div class="col-span-6">Hujjat nomi</div>
                <div class="col-span-2 text-center">Fayl turi</div>
                <div class="col-span-3 text-center">Amallar</div>
            </div>
        `;
        
        category.docs.forEach((doc, docIndex) => {
            const fileExtension = doc.file ? doc.file.split('.').pop().toLowerCase() : 'unknown';
            const fileIcon = getFileIcon(fileExtension);
            const createDate = doc.create_at ? new Date(doc.create_at).toLocaleDateString('uz-UZ') : 'N/A';
            const docButtonId = `doc-btn-${doc.id}`;
            const downloadButtonId = `download-btn-${doc.id}`;
            
            html += `
                <div class="grid grid-cols-12 gap-4 px-4 py-3 items-center border-b border-border-light dark:border-border-dark last:border-0">
                    <div class="col-span-1 text-center font-medium">${docIndex + 1}</div>
                    <div class="col-span-6">
                        <div class="flex items-center gap-2">
                            <span class="material-icons-outlined ${fileIcon}">description</span>
                            <span class="truncate">${doc.title || 'Nomsiz hujjat'}</span>
                        </div>
                    </div>
                    <div class="col-span-2 text-center">
                        <span class="px-2 py-1 text-xs bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded">${fileExtension.toUpperCase()}</span>
                    </div>
                    <div class="col-span-3 text-center">
                        <div class="flex gap-2 justify-center">
                            <button 
                                id="${docButtonId}"
                                class="px-3 py-1 text-sm text-white bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors flex items-center gap-1"
                                ${!doc.file ? 'disabled' : ''}
                            >
                                <span class="material-icons-outlined text-sm">visibility</span>
                                Ko'rish
                            </button>
                            <button 
                                id="${downloadButtonId}"
                                class="px-3 py-1 text-sm text-white bg-green-500 hover:bg-green-600 rounded-lg transition-colors flex items-center gap-1"
                                ${!doc.file ? 'disabled' : ''}
                            >
                                <span class="material-icons-outlined text-sm">download</span>
                                Yuklab olish
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners to buttons
            setTimeout(() => {
                const viewButton = document.getElementById(docButtonId);
                const downloadButton = document.getElementById(downloadButtonId);
                
                if (viewButton) {
                    viewButton.addEventListener('click', function(e) {
                        e.stopPropagation();
                        viewDocument(
                            doc.id, 
                            doc.title || 'Nomsiz hujjat', 
                            doc.file, 
                            fileExtension, 
                            category.department_name || '', 
                            category.tartib_raqami || '', 
                            createDate
                        );
                    });
                }
                
                if (downloadButton) {
                    downloadButton.addEventListener('click', function(e) {
                        e.stopPropagation();
                        downloadFile(
                            doc.file, 
                            (doc.title || 'hujjat') + '.' + fileExtension
                        );
                    });
                }
            }, 50);
        });
    } else {
        html += `
            <div class="text-center py-6 text-muted-light dark:text-muted-dark">
                <span class="material-icons-outlined text-3xl mb-2">insert_drive_file</span>
                <p>Hujjatlar mavjud emas</p>
            </div>
        `;
    }
    
    html += '</div>';
    contentDiv.innerHTML = html;
}

// Toggle department collapse
function toggleDepartment(deptId) {
    const content = document.getElementById(`deptContent-${deptId}`);
    const icon = document.getElementById(`deptIcon-${deptId}`);
    
    if (content.classList.contains('expanded')) {
        content.classList.remove('expanded');
        if (icon) icon.style.transform = 'rotate(0deg)';
    } else {
        content.classList.add('expanded');
        if (icon) icon.style.transform = 'rotate(180deg)';
    }
}

// Toggle category collapse
function toggleCategory(deptId, catId) {
    const content = document.getElementById(`catContent-${deptId}-${catId}`);
    if (content) {
        if (content.classList.contains('expanded')) {
            content.classList.remove('expanded');
        } else {
            content.classList.add('expanded');
        }
    }
}

// Get file icon class
function getFileIcon(extension) {
    switch(extension) {
        case 'pdf': return 'pdf-icon';
        case 'doc':
        case 'docx': return 'doc-icon';
        case 'xls':
        case 'xlsx': return 'xls-icon';
        case 'jpg':
        case 'jpeg':
        case 'png':
        case 'gif': return 'img-icon';
        default: return 'default-icon';
    }
}

// Setup search
function setupSearch() {
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase().trim();
        
        if (searchTerm === '') {
            applyClientSideFilters();
            return;
        }
        
        performGlobalSearch(searchTerm);
    });
}

// Perform global search
function performGlobalSearch(searchTerm) {
    let filteredData = [...allData];
    
    if (currentFilters.documentType) {
        filteredData = filterByDocumentType(filteredData, currentFilters.documentType);
    }
    
    if (currentFilters.dateFilter) {
        filteredData = filterByDate(filteredData, parseInt(currentFilters.dateFilter));
    }
    
    const searchResults = [];
    
    filteredData.forEach(department => {
        const deptMatches = department.title.toLowerCase().includes(searchTerm);
        
        const filteredCategories = [];
        if (department.categories && department.categories.length > 0) {
            department.categories.forEach(category => {
                const categoryMatches = 
                    (category.ichki_raqam && category.ichki_raqam.toLowerCase().includes(searchTerm)) ||
                    (category.tartib_raqami && category.tartib_raqami.toLowerCase().includes(searchTerm)) ||
                    (category.izoh && category.izoh.toLowerCase().includes(searchTerm));
                
                let filteredDocs = [];
                if (category.docs && category.docs.length > 0) {
                    filteredDocs = category.docs.filter(doc => 
                        (doc.title && doc.title.toLowerCase().includes(searchTerm))
                    );
                }
                
                if (categoryMatches || filteredDocs.length > 0) {
                    const filteredCategory = { ...category };
                    if (filteredDocs.length > 0) {
                        filteredCategory.docs = filteredDocs;
                    }
                    filteredCategories.push(filteredCategory);
                }
            });
        }
        
        if (deptMatches || filteredCategories.length > 0) {
            const filteredDept = { ...department };
            if (filteredCategories.length > 0) {
                filteredDept.categories = filteredCategories;
            }
            searchResults.push(filteredDept);
        }
    });
    
    if (searchResults.length === 0) {
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = `
            <div class="p-8 text-center text-muted-light dark:text-muted-dark">
                <span class="material-icons-outlined text-4xl mb-2">search_off</span>
                <p>"${searchTerm}" so'zi bo'yicha hech narsa topilmadi</p>
            </div>
        `;
    } else {
        renderTable(searchResults);
    }
}

// Show loading spinner
function showLoading() {
    document.getElementById('loadingSpinner').classList.remove('hidden');
    document.getElementById('tableBody').classList.add('hidden');
}

// Hide loading spinner
function hideLoading() {
    document.getElementById('loadingSpinner').classList.add('hidden');
    document.getElementById('tableBody').classList.remove('hidden');
}

// Show error message
function showError(message) {
    const errorElement = document.getElementById('errorMessage');
    const errorText = document.getElementById('errorText');
    
    errorText.textContent = message;
    errorElement.classList.remove('hidden');
}

// Hide error message
function hideError() {
    document.getElementById('errorMessage').classList.add('hidden');
}

// Refresh data
function refreshData() {
    document.getElementById('departmentFilter').value = '';
    document.getElementById('documentTypeFilter').value = '';
    document.getElementById('dateFilter').value = '';
    document.getElementById('searchInput').value = '';
    
    currentDepartment = '';
    currentFilters = { department: '', documentType: '', dateFilter: '' };
    
    populateTable({});
}

// Format izoh text
function formatIzoh(izoh) {
    if (!izoh) return '';
    const shortIzoh = izoh.length > 50 ? izoh.substring(0, 50) + '...' : izoh;
    return shortIzoh.replace(/\r\n/g, '<br>').replace(/\n/g, '<br>');
}

// Escape HTML
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// View document modal
function viewDocument(docId, docTitle, fileUrl, fileType, department, category, createDate) {
    modalDocumentData = {
        id: docId,
        title: docTitle,
        fileUrl: fileUrl,
        fileType: fileType,
        department: department,
        category: category,
        createDate: createDate
    };
    
    document.getElementById('modalDocumentTitle').textContent = docTitle;
    document.getElementById('modalDocName').textContent = docTitle;
    document.getElementById('modalFileType').textContent = fileType.toUpperCase();
    document.getElementById('modalCreateDate').textContent = createDate;
    document.getElementById('modalDepartment').textContent = department;
    document.getElementById('modalCategory').textContent = category;
    document.getElementById('modalFileUrl').value = fileUrl;
    
    loadFileContent(fileUrl, fileType);
    
    showDocumentModal();
}

// Load file content for modal
async function loadFileContent(fileUrl, fileType) {
    const contentElement = document.getElementById('modalFileContent');
    
    if (!fileUrl) {
        contentElement.innerHTML = `
            <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                <div class="flex items-center">
                    <span class="material-icons-outlined text-yellow-600 dark:text-yellow-400 mr-2">warning</span>
                    <p class="text-yellow-700 dark:text-yellow-300">Fayl manzili mavjud emas</p>
                </div>
            </div>
        `;
        return;
    }
    
    const fullUrl = 'https://backend-arxiv.tmsiti.uz' + fileUrl;
    
    if (fileType === 'pdf' || fileUrl.toLowerCase().endsWith('.pdf')) {
        contentElement.innerHTML = `
            <div class="h-96">
                <iframe src="${fullUrl}" class="w-full h-full border-none rounded"></iframe>
            </div>
            <p class="text-sm text-muted-light dark:text-muted-dark mt-2">PDF fayl yuklandi</p>
        `;
    } else if (['jpg', 'jpeg', 'png', 'gif'].includes(fileType) || fileUrl.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)) {
        contentElement.innerHTML = `
            <img src="${fullUrl}" alt="${modalDocumentData.title}" class="max-h-96 mx-auto rounded">
            <p class="text-sm text-muted-light dark:text-muted-dark mt-2">Rasm fayli yuklandi</p>
        `;
    } else if (['doc', 'docx'].includes(fileType) || fileUrl.toLowerCase().match(/\.(doc|docx)$/)) {
        contentElement.innerHTML = `
            <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg mb-4">
                <div class="flex items-center">
                    <span class="material-icons-outlined text-blue-600 dark:text-blue-400 mr-2">info</span>
                    <p class="text-blue-700 dark:text-blue-300">Word hujjati. Yuklab olish uchun "Yuklab olish" tugmasini bosing.</p>
                </div>
            </div>
            <div class="h-96">
                <iframe src="https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(fullUrl)}" class="w-full h-full border-none rounded"></iframe>
            </div>
        `;
    } else {
        contentElement.innerHTML = `
            <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                <div class="flex items-center">
                    <span class="material-icons-outlined text-blue-600 dark:text-blue-400 mr-2">info</span>
                    <p class="text-blue-700 dark:text-blue-300">
                        Bu turdagi faylni to'g'ridan-to'g'ri ko'rish imkoni mavjud emas.<br>
                        Faylni ko'rish uchun "Yuklab olish" tugmasini bosing.
                    </p>
                </div>
            </div>
        `;
    }
}

// Download file from modal
function downloadFromModal() {
    if (!modalDocumentData.fileUrl) {
        alert('Fayl manzili mavjud emas');
        return;
    }
    
    downloadFile(modalDocumentData.fileUrl, `${modalDocumentData.title}.${modalDocumentData.fileType}`);
}

// Open file in new tab
function openFileInNewTab() {
    if (!modalDocumentData.fileUrl) {
        alert('Fayl manzili mavjud emas');
        return;
    }
    
    const fullUrl = 'https://backend-arxiv.tmsiti.uz' + modalDocumentData.fileUrl;
    window.open(fullUrl, '_blank');
}

// Copy file URL
function copyFileUrl() {
    const fileUrlInput = document.getElementById('modalFileUrl');
    fileUrlInput.select();
    fileUrlInput.setSelectionRange(0, 99999);
    
    try {
        navigator.clipboard.writeText(fileUrlInput.value);
        alert('Fayl manzili nusxalandi!');
    } catch (err) {
        console.error('Nusxalashda xatolik:', err);
        alert('Nusxalash amalga oshmadi. Iltimos, qolda nusxalang.');
    }
}

// Download file
function downloadFile(filePath, fileName) {
    if (!filePath) {
        alert('Fayl manzili mavjud emas');
        return;
    }
    
    const fullUrl = 'https://backend-arxiv.tmsiti.uz' + filePath;
    const link = document.createElement('a');
    link.href = fullUrl;
    link.download = fileName || 'hujjat';
    link.target = '_blank';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Show document modal
function showDocumentModal() {
    document.getElementById('documentViewModal').classList.remove('hidden');
}

// Hide document modal
function hideDocumentModal() {
    document.getElementById('documentViewModal').classList.add('hidden');
}

// Show logout modal
function showLogoutModal() {
    document.getElementById('logoutModal').classList.remove('hidden');
}

// Hide logout modal
function hideLogoutModal() {
    document.getElementById('logoutModal').classList.add('hidden');
}

// Confirm logout
function confirmLogout() {
    localStorage.removeItem('authToken');
    localStorage.removeItem('userData');
    hideLogoutModal();
    window.location.href = 'login.html';
}

// Toggle dark mode
function toggleDarkMode() {
    const html = document.documentElement;
    const themeIcon = document.getElementById('themeIcon');
    
    if (html.classList.contains('dark')) {
        html.classList.remove('dark');
        themeIcon.textContent = 'dark_mode';
        localStorage.setItem('darkMode', 'false');
    } else {
        html.classList.add('dark');
        themeIcon.textContent = 'light_mode';
        localStorage.setItem('darkMode', 'true');
    }
}

// Toggle sidebar
function toggleSidebar() {
    const sidebar = document.querySelector('aside');
    if (sidebar.classList.contains('w-64')) {
        sidebar.classList.remove('w-64');
        sidebar.classList.add('w-0', 'hidden');
    } else {
        sidebar.classList.remove('w-0', 'hidden');
        sidebar.classList.add('w-64');
    }
}

// Toggle submenu
function toggleSubMenu(event) {
    event.preventDefault();
    const subMenu = document.getElementById('subMenu');
    const icon = document.getElementById('subMenuIcon');
    
    if (subMenu.classList.contains('expanded')) {
        subMenu.classList.remove('expanded');
        icon.style.transform = 'rotate(0deg)';
    } else {
        subMenu.classList.add('expanded');
        icon.style.transform = 'rotate(180deg)';
    }
}

// Toggle notifications
function toggleNotifications() {
    alert('Bildirishnomalar bo\'limi ishlab chiqilmoqda...');
}
</script>
</body>
</html>